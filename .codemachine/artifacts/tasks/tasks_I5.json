[
  {
    "task_id": "I5.T1",
    "iteration_id": "I5",
    "iteration_goal": "Finalize persistence workflows (save/load/versioning), build export (SVG/PDF) and import (AI/SVG) services, and capture the supporting activity diagram plus regression tests to close Milestone 0.1.",
    "description": "Implement Save Document pipeline (T033) tying UI commands to EventStore/SnapshotManager, ensuring atomic writes, backups, and telemetry.",
    "agent_type_hint": "BackendAgent",
    "inputs": "Save/Load spec, event store, snapshot serializer.",
    "target_files": [
      "lib/src/services/file_ops/save_service.dart",
      "lib/src/services/file_ops/file_picker_adapter.dart",
      "integration_test/save_flow_test.dart"
    ],
    "input_files": [
      "lib/src/services/file_ops/save_service.dart",
      "lib/src/event_sourcing/persistence/",
      "test/integration/save_flow_test.dart"
    ],
    "deliverables": "Save service with dependency injection, UI command wiring, integration test covering save + reopen scenario.",
    "acceptance_criteria": "- Save writes metadata/events/snapshots within single WAL-backed transaction; temp file rename ensures atomicity.\n        - Telemetry logs file size, event count, snapshot ratio.\n        - Integration test verifies reopened document equals pre-save snapshot hash.",
    "dependencies": [
      "I4.T3",
      "I1.T7"
    ],
    "parallelizable": false,
    "done": true
  },
  {
    "task_id": "I5.T2",
    "iteration_id": "I5",
    "iteration_goal": "Finalize persistence workflows (save/load/versioning), build export (SVG/PDF) and import (AI/SVG) services, and capture the supporting activity diagram plus regression tests to close Milestone 0.1.",
    "description": "Implement Load Document + version negotiation (T034/T035) and author File Ops Activity Diagram (Mermaid) covering save/load/export/import flows.",
    "agent_type_hint": "BackendAgent",
    "inputs": "Save service, event navigator, persistence contract.",
    "target_files": [
      "lib/src/services/file_ops/load_service.dart",
      "lib/src/services/file_ops/version_migrator.dart",
      "docs/diagrams/file_ops_activity.mmd",
      "integration_test/load_upgrade_test.dart"
    ],
    "input_files": [
      "lib/src/services/file_ops/load_service.dart",
      "docs/diagrams/file_ops_activity.mmd",
      "test/integration/load_flow_test.dart"
    ],
    "deliverables": "Load service that selects latest snapshot, replays deltas, runs migrations for older format versions, plus Mermaid activity diagram.",
    "acceptance_criteria": "- Load handles corrupt events gracefully (skips + warns) and surfaces UI alert.\n        - Version migrator upgrades ≤ previous format version tests (fixtures) and writes upgrade notes to telemetry.\n        - Diagram illustrates branching for save, load, export, import with error nodes; passes Mermaid CLI validation.",
    "dependencies": [
      "I5.T1"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I5.T3",
    "iteration_id": "I5",
    "iteration_goal": "Finalize persistence workflows (save/load/versioning), build export (SVG/PDF) and import (AI/SVG) services, and capture the supporting activity diagram plus regression tests to close Milestone 0.1.",
    "description": "Build SVG export service (T036) translating Document to SVG 1.1, including metadata, transforms, styles, and test harness comparing golden SVG output.",
    "agent_type_hint": "BackendAgent",
    "inputs": "Rendering pipeline, document model, persistence contract.",
    "target_files": [
      "lib/src/services/export/svg_exporter.dart",
      "lib/src/services/export/svg_writer.dart",
      "test/unit/svg_exporter_test.dart"
    ],
    "input_files": [
      "lib/src/services/export/svg_exporter.dart",
      "test/unit/svg_exporter_test.dart",
      "docs/specs/export_import.md"
    ],
    "deliverables": "Export service + writer utilities, tests verifying path/shape serialization, style mapping, and transform preservation.",
    "acceptance_criteria": "- Supports groups, layers, selection markers removed; output passes `svglint`.\n        - Handles >5k objects within 5 s for benchmark doc.\n        - Documented limitations (filters, gradients) noted in export spec.",
    "dependencies": [
      "I2.T6",
      "I4.T5"
    ],
    "parallelizable": true,
    "done": false
  },
  {
    "task_id": "I5.T4",
    "iteration_id": "I5",
    "iteration_goal": "Finalize persistence workflows (save/load/versioning), build export (SVG/PDF) and import (AI/SVG) services, and capture the supporting activity diagram plus regression tests to close Milestone 0.1.",
    "description": "Implement PDF export (T037) leveraging `pdf` package, ensuring vector fidelity, page sizing, and metadata insertion.",
    "agent_type_hint": "BackendAgent",
    "inputs": "SVG exporter, document model.",
    "target_files": [
      "lib/src/services/export/pdf_exporter.dart",
      "test/unit/pdf_exporter_test.dart"
    ],
    "input_files": [
      "lib/src/services/export/pdf_exporter.dart",
      "test/unit/pdf_exporter_test.dart"
    ],
    "deliverables": "PDF exporter with artboard/page selection, CMYK color conversion helper, tests verifying Bezier accuracy via path length comparison.",
    "acceptance_criteria": "- Exported PDF opens in Preview/Adobe without rasterization; vector selectors confirm path presence.\n        - Color profiles embedded; metadata includes document title/version.\n        - Exports complete with <10 s for benchmark doc.",
    "dependencies": [
      "I5.T3"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I5.T5",
    "iteration_id": "I5",
    "iteration_goal": "Finalize persistence workflows (save/load/versioning), build export (SVG/PDF) and import (AI/SVG) services, and capture the supporting activity diagram plus regression tests to close Milestone 0.1.",
    "description": "Implement AI import pipeline (T038) focusing on PDF-based AI files plus SVG import (T039), sharing a common parser abstraction and validation harness.",
    "agent_type_hint": "BackendAgent",
    "inputs": "Event schema, document model, persistence contract.",
    "target_files": [
      "lib/src/services/import/ai_importer.dart",
      "lib/src/services/import/svg_importer.dart",
      "lib/src/services/import/import_validator.dart",
      "integration_test/import_roundtrip_test.dart",
      "docs/specs/import_compatibility.md"
    ],
    "input_files": [
      "lib/src/services/import/",
      "test/integration/import_flow_test.dart",
      "docs/specs/import_compatibility.md"
    ],
    "deliverables": "Import services for AI (PDF parser) and SVG (XML parser) that convert inputs into event streams, plus documentation outlining supported features/limitations.",
    "acceptance_criteria": "- Imports basic shapes, paths, groups, transforms; unsupported features logged but do not crash.\n        - Round-trip golden test: import AI/SVG → render → export SVG matches baseline within tolerance.\n        - Security constraints (max file size, disabled external entities) enforced.",
    "dependencies": [
      "I5.T2",
      "I5.T3"
    ],
    "parallelizable": false,
    "done": false
  }
]