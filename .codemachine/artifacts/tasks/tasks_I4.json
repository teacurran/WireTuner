[
  {
    "task_id": "I4.T1",
    "iteration_id": "I4",
    "iteration_goal": "Deliver parametric shape tools, finalize direct manipulation workflows (anchors, BCPs, objects, multi-select), and define the save/load API contract to align tooling output with persistence expectations.",
    "description": "Implement Rectangle and Ellipse tools (T025/T026) with adjustable radii/aspect locks, leveraging shared shape controller infrastructure.",
    "agent_type_hint": "FrontendAgent",
    "inputs": "Tool framework, geometry models, rendering overlay.",
    "target_files": [
      "lib/src/tools/shapes/rectangle_tool.dart",
      "lib/src/tools/shapes/ellipse_tool.dart",
      "lib/src/tools/shapes/shape_base.dart",
      "test/widget/shape_tool_rect_ellipse_test.dart"
    ],
    "input_files": [
      "lib/src/tools/shapes/rectangle_tool.dart",
      "lib/src/tools/shapes/ellipse_tool.dart",
      "test/widget/shape_tool_rect_ellipse_test.dart"
    ],
    "deliverables": "Shape base class, rectangle/ellipse controllers with snapping, preview overlays, widget tests verifying emitted events.",
    "acceptance_criteria": "- Drag interaction emits CreateShape + UpdateShape events with normalized dimensions.\n        - Holding Shift enforces square/circle; Option toggles from center.\n        - Tests assert shape parameters stored in Document and render correctly.",
    "dependencies": [
      "I3.T1",
      "I2.T6"
    ],
    "parallelizable": true,
    "done": true
  },
  {
    "task_id": "I4.T2",
    "iteration_id": "I4",
    "iteration_goal": "Deliver parametric shape tools, finalize direct manipulation workflows (anchors, BCPs, objects, multi-select), and define the save/load API contract to align tooling output with persistence expectations.",
    "description": "Deliver Polygon and Star tools (T027/T028) with UI for sides/points, inner radius, and rotational alignment; persist parameters for later editing.",
    "agent_type_hint": "FrontendAgent",
    "inputs": "Shape base, geometry utilities.",
    "target_files": [
      "lib/src/tools/shapes/polygon_tool.dart",
      "lib/src/tools/shapes/star_tool.dart",
      "lib/src/tools/shapes/shape_options_panel.dart",
      "test/widget/shape_tool_polygon_star_test.dart"
    ],
    "input_files": [
      "lib/src/tools/shapes/polygon_tool.dart",
      "lib/src/tools/shapes/star_tool.dart",
      "lib/src/domain/models/shape.dart",
      "test/widget/shape_tool_polygon_star_test.dart"
    ],
    "deliverables": "Controllers for polygon/star, property panel widget, tests verifying event payloads and re-editing via direct selection.",
    "acceptance_criteria": "- Parameter UI updates tool state and emits UpdateShapeParam events.\n        - Star inner radius guards against invalid values; polygon sides >= 3 enforced.\n        - Replay reproduces identical geometry (verified via golden test hash).",
    "dependencies": [
      "I4.T1"
    ],
    "parallelizable": false,
    "done": true
  },
  {
    "task_id": "I4.T3",
    "iteration_id": "I4",
    "iteration_goal": "Deliver parametric shape tools, finalize direct manipulation workflows (anchors, BCPs, objects, multi-select), and define the save/load API contract to align tooling output with persistence expectations.",
    "description": "Define Save/Load API contract (OpenAPI v3 YAML + Markdown narrative) covering document IO commands, metadata, version negotiation, and error codes.",
    "agent_type_hint": "DocumentationAgent",
    "inputs": "Sections 2 & 2.1, event schema, snapshot serializer.",
    "target_files": [
      "api/save_load.yaml",
      "docs/specs/persistence_contract.md"
    ],
    "input_files": [
      "api/save_load.yaml",
      "docs/specs/persistence_contract.md"
    ],
    "deliverables": "OpenAPI spec (even though local) documenting pseudo-endpoints/methods for save/load/export, Markdown contract describing CLI/GUI triggers.",
    "acceptance_criteria": "- Spec validates via `openapi-cli lint` (documented command) and includes schemas referencing event snapshot structures.\n        - Contract outlines versioning rules, recovery steps, and relation to `.wiretuner` extension.\n        - Referenced by I5 persistence tasks as normative source.",
    "dependencies": [
      "I2.T4",
      "I2.T3"
    ],
    "parallelizable": true,
    "done": true
  },
  {
    "task_id": "I4.T4",
    "iteration_id": "I4",
    "iteration_goal": "Deliver parametric shape tools, finalize direct manipulation workflows (anchors, BCPs, objects, multi-select), and define the save/load API contract to align tooling output with persistence expectations.",
    "description": "Implement anchor point dragging + BCP handle dragging improvements (T029/T030) with smoothing, snapping, and on-canvas numeric feedback.",
    "agent_type_hint": "FrontendAgent",
    "inputs": "Direct selection tool, telemetry metrics, geometry services.",
    "target_files": [
      "lib/src/tools/direct_selection/anchor_drag_controller.dart",
      "lib/src/tools/direct_selection/handle_drag_controller.dart",
      "lib/src/tools/direct_selection/snapping_service.dart",
      "test/widget/anchor_drag_test.dart"
    ],
    "input_files": [
      "lib/src/tools/direct_selection/",
      "lib/src/canvas/overlays/",
      "test/widget/anchor_drag_test.dart"
    ],
    "deliverables": "Enhanced drag controllers with snap-to-grid/path options, UI feedback for angle/length, tests verifying event emission cadence and snapping accuracy.",
    "acceptance_criteria": "- Snapping toggled via modifier, defaults to 15Â° increments.\n        - Handle drag emits AdjustHandle events with symmetrical toggles; sampler backlog warnings logged if thresholds exceeded.\n        - Tests cover simultaneous multi-anchor adjustments and ensure no mutations outside event pipeline.",
    "dependencies": [
      "I3.T4"
    ],
    "parallelizable": false,
    "done": true
  },
  {
    "task_id": "I4.T5",
    "iteration_id": "I4",
    "iteration_goal": "Deliver parametric shape tools, finalize direct manipulation workflows (anchors, BCPs, objects, multi-select), and define the save/load API contract to align tooling output with persistence expectations.",
    "description": "Implement object dragging and multi-selection support (T031/T032) including bounding-box transforms, constraint modifiers, and multi-select data model updates.",
    "agent_type_hint": "FrontendAgent",
    "inputs": "Selection tool, document selection APIs, viewport transforms.",
    "target_files": [
      "lib/application/tools/selection/object_drag_controller.dart",
      "lib/domain/document/selection.dart",
      "test/widget/multi_selection_test.dart"
    ],
    "input_files": [
      "lib/application/tools/selection/",
      "lib/domain/document/selection.dart",
      "test/widget/multi_selection_test.dart"
    ],
    "deliverables": "Object drag controller with grid snapping, SHIFT-proportional scaling, multi-selection data model enhancements, widget tests verifying selection sets.",
    "acceptance_criteria": "- Multi-select interactions maintain deterministic event sequences on replay.\n        - Object drag manipulates transforms, not vertex data; events aggregated per frame.\n        - Tests confirm selection serialization and viewport integration (scroll-to-selection option).",
    "dependencies": [
      "I3.T3",
      "I3.T4"
    ],
    "parallelizable": false,
    "done": true
  }
]
