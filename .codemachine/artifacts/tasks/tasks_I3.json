[
  {
    "task_id": "I3.T1",
    "iteration_id": "I3",
    "iteration_goal": "Build the extensible tool framework, deliver selection/direct selection experiences, and implement the full pen workflow (anchors, straight segments, Bezier curves, BCP adjustments) with supporting diagrams and telemetry.",
    "description": "Create the Tool Framework (T018) including `ToolManager`, base `ITool` interface, cursor service, overlay hooks, and integrate with Provider/app shell.",
    "agent_type_hint": "FrontendAgent",
    "inputs": "Sections 2 & 2.1, rendering outputs, selection overlay.",
    "target_files": [
      "lib/src/tools/framework/tool_manager.dart",
      "lib/src/tools/framework/tool_interface.dart",
      "lib/src/tools/framework/cursor_service.dart",
      "test/unit/tool_manager_test.dart"
    ],
    "input_files": [
      "lib/src/tools/framework/",
      "lib/src/app/shell/",
      "test/unit/tool_manager_test.dart"
    ],
    "deliverables": "Tool lifecycle APIs (activate/deactivate), keyboard routing, cursor management, unit tests for state transitions.",
    "acceptance_criteria": "- Tools register/unregister cleanly; only one active tool at a time.\n        - Cursor updates propagate within <1 frame.\n        - Test suite covers tool activation, hotkeys, and ensures overlays render via callbacks.",
    "dependencies": [
      "I2.T6"
    ],
    "parallelizable": false,
    "done": true
  },
  {
    "task_id": "I3.T2",
    "iteration_id": "I3",
    "iteration_goal": "Build the extensible tool framework, deliver selection/direct selection experiences, and implement the full pen workflow (anchors, straight segments, Bezier curves, BCP adjustments) with supporting diagrams and telemetry.",
    "description": "Document the Tool Interaction Sequence (PlantUML) focusing on pen + selection flows and pointer sampling, aligning with event recorder behavior.",
    "agent_type_hint": "DiagrammingAgent",
    "inputs": "Tool framework, event flow doc.",
    "target_files": [
      "docs/diagrams/tool_interaction_sequence.puml",
      "docs/specs/tool_interactions.md"
    ],
    "input_files": [
      "docs/diagrams/tool_interaction_sequence.puml",
      "docs/specs/event_lifecycle.md"
    ],
    "deliverables": "Sequence diagram + narrative describing pointer down/move/up events, event batching, and undo grouping.",
    "acceptance_criteria": "- Diagram renders; includes states for `ToolManager`, `PenTool`, `EventRecorder`, `SnapshotManager`.\n        - Markdown outlines undo grouping rules (start/end markers) and acceptance for sampling accuracy.",
    "dependencies": [
      "I3.T1"
    ],
    "parallelizable": true,
    "done": true
  },
  {
    "task_id": "I3.T3",
    "iteration_id": "I3",
    "iteration_goal": "Build the extensible tool framework, deliver selection/direct selection experiences, and implement the full pen workflow (anchors, straight segments, Bezier curves, BCP adjustments) with supporting diagrams and telemetry.",
    "description": "Implement Selection Tool (T019) including marquee selection, object transforms, and integration with selection overlay/telemetry.",
    "agent_type_hint": "FrontendAgent",
    "inputs": "Tool framework, selection overlay, document query APIs.",
    "target_files": [
      "lib/src/tools/selection/selection_tool.dart",
      "lib/src/tools/selection/marquee_controller.dart",
      "test/widget/selection_tool_test.dart"
    ],
    "input_files": [
      "lib/src/tools/selection/",
      "lib/src/domain/document/",
      "test/widget/selection_tool_test.dart"
    ],
    "deliverables": "Selection tool with Shift/Cmd modifiers, marquee rectangle, translations emitting MoveObject events, widget tests verifying selection states.",
    "acceptance_criteria": "- Tool selects via click, multi-select via modifiers, and marquee respects viewport transforms.\n        - Event recorder receives MoveObject events with aggregated deltas.\n        - Tests assert selection state updates and overlays highlight correctly.",
    "dependencies": [
      "I3.T1"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I3.T4",
    "iteration_id": "I3",
    "iteration_goal": "Build the extensible tool framework, deliver selection/direct selection experiences, and implement the full pen workflow (anchors, straight segments, Bezier curves, BCP adjustments) with supporting diagrams and telemetry.",
    "description": "Deliver Direct Selection Tool (T020) for anchor/BCP interaction, hooking into hit-testing and event sampling, plus telemetry instrumentation for drag latency.",
    "agent_type_hint": "FrontendAgent",
    "inputs": "Selection overlay, event recorder, tool diagram.",
    "target_files": [
      "lib/src/tools/direct_selection/direct_selection_tool.dart",
      "lib/src/tools/direct_selection/drag_controller.dart",
      "test/widget/direct_selection_tool_test.dart",
      "lib/src/services/telemetry/tool_metrics.dart"
    ],
    "input_files": [
      "lib/src/tools/direct_selection/",
      "lib/src/domain/geometry/",
      "test/widget/direct_selection_tool_test.dart"
    ],
    "deliverables": "Direct selection interactions (anchor selection, BCP display, drag), telemetry counters (events/sec, latency), tests for anchor hit logic.",
    "acceptance_criteria": "- Dragging anchors emits MoveAnchor events at 50â€¯ms cadence with final flush on pointer up.\n        - Telemetry event logged when drag > threshold (configurable) or sampler backlog occurs.\n        - Tests verify BCP symmetry toggles and anchor type conversions.",
    "dependencies": [
      "I3.T3"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I3.T5",
    "iteration_id": "I3",
    "iteration_goal": "Build the extensible tool framework, deliver selection/direct selection experiences, and implement the full pen workflow (anchors, straight segments, Bezier curves, BCP adjustments) with supporting diagrams and telemetry.",
    "description": "Implement Pen Tool anchor placement and straight segments (T021/T022) with visual preview, undo grouping, and event emission.",
    "agent_type_hint": "FrontendAgent",
    "inputs": "Tool framework, tool interaction doc, path models.",
    "target_files": [
      "lib/src/tools/pen/pen_tool.dart",
      "lib/src/tools/pen/pen_preview_overlay.dart",
      "test/widget/pen_tool_straight_test.dart"
    ],
    "input_files": [
      "lib/src/tools/pen/",
      "lib/src/domain/models/",
      "test/widget/pen_tool_straight_test.dart"
    ],
    "deliverables": "Pen tool state machine (idle, creating path, editing), preview overlay for forthcoming segment, tests verifying anchor creation order and event payloads.",
    "acceptance_criteria": "- Single-click adds anchor; Enter/double-click completes open path; Shift+click constrains angles.\n        - Recorder receives CreatePath + AddAnchor events with sequential IDs.\n        - Undo removes entire path creation session via grouping tokens.",
    "dependencies": [
      "I3.T4"
    ],
    "parallelizable": false,
    "done": false
  },
  {
    "task_id": "I3.T6",
    "iteration_id": "I3",
    "iteration_goal": "Build the extensible tool framework, deliver selection/direct selection experiences, and implement the full pen workflow (anchors, straight segments, Bezier curves, BCP adjustments) with supporting diagrams and telemetry.",
    "description": "Extend Pen Tool for Bezier curves and BCP adjustments (T023/T024), including drag-to-curve gestures, BCP symmetry toggles, and BCP adjustment UI.",
    "agent_type_hint": "FrontendAgent",
    "inputs": "Pen tool base, direct selection behaviors, geometry utilities.",
    "target_files": [
      "lib/src/tools/pen/pen_bezier_controller.dart",
      "lib/src/tools/pen/pen_handle_overlay.dart",
      "test/widget/pen_tool_bezier_test.dart"
    ],
    "input_files": [
      "lib/src/tools/pen/",
      "lib/src/domain/geometry/",
      "test/widget/pen_tool_bezier_test.dart"
    ],
    "deliverables": "Drag-to-create Bezier segments, automatic BCP mirroring, handle editing prior to path completion, tests covering symmetric/corner anchor transitions.",
    "acceptance_criteria": "- Holding mouse drag during anchor placement emits AddAnchor with handle vectors scaled to drag distance.\n        - ALT/Option toggles corner/smooth anchor types mid-gesture.\n        - BCP adjustments emit AdjustHandle events and replay deterministically.",
    "dependencies": [
      "I3.T5"
    ],
    "parallelizable": false,
    "done": false
  }
]