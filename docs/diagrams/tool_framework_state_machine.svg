<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="STATE" height="2044px" preserveAspectRatio="none" style="width:5199px;height:2044px;background:#FFFFFF;" version="1.1" viewBox="0 0 5199 2044" width="5199px" zoomAndPan="magnify"><title>Tool Framework State Machine - Selection, Direct Selection, and Pen Tools</title><defs/><g><g class="title" data-source-line="1"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="535.6504" x="2325.1353" y="23.5352">Tool Framework State Machine - Selection, Direct Selection, and Pen Tools</text></g><g class="legend" data-source-line="475"><rect fill="#DDDDDD" height="686.0195" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:1;" width="400.332" x="12" y="49.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="52.2539" x="17" y="68.0234">Legend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="17" y="84.5117">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="205.2285" x="17" y="101">Event Sampling (Decision 5):</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="339.0078" x="17" y="117.4883">High-frequency events sampled at 50ms intervals</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="390.332" x="17" y="133.9766">to reduce event volume while maintaining smooth replay.</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="17" y="150.4648">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.3662" x="17" y="166.9531">Sampled Events:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="269.5" x="17" y="183.4414">&#8226; MoveObjectEvent (Selection tool drag)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="298.1426" x="17" y="199.9297">&#8226; ModifyAnchorEvent (Direct Selection drag)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="17" y="216.418">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146.0977" x="17" y="232.9063">Non-Sampled Events:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="242.0332" x="17" y="249.3945">&#8226; SelectObjectsEvent (discrete click)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="242.9629" x="17" y="265.8828">&#8226; CreatePathEvent (lifecycle marker)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="317.7412" x="17" y="282.3711">&#8226; AddAnchorEvent (discrete anchor placement)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="17" y="298.8594">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="112.9912" x="17" y="315.3477">Undo Grouping:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="245.2393" x="17" y="331.8359">Multi-event operations grouped via:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="280.3076" x="17" y="348.3242">&#8226; StartGroupEvent (undoGroupStart: true)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="292.4893" x="17" y="364.8125">&#8226; Intermediate events (undoGroupId: UUID)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="267.5381" x="17" y="381.3008">&#8226; EndGroupEvent (undoGroupEnd: true)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="17" y="397.7891">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="129.7939" x="17" y="414.2773">Guard Conditions:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="310.7002" x="17" y="430.7656">[condition] &#8594; Boolean check before transition</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.2002" x="17" y="447.2539">Examples:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="275.8506" x="17" y="463.7422">&#8226; [drag distance &lt; 5.0] &#8594; click, not drag</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="290.2197" x="17" y="480.2305">&#8226; [drag distance &gt;= 5.0] &#8594; drag operation</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="262.083" x="17" y="496.7188">&#8226; [hover over object] &#8594; hit test passed</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="17" y="513.207">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="71.5176" x="17" y="529.6953">Event IDs:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.2021" x="17" y="546.1836">All events include:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125.4463" x="17" y="562.6719">&#8226; eventId (UUIDv4)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="218.0049" x="17" y="579.1602">&#8226; timestamp (Unix milliseconds)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="259.6836" x="17" y="595.6484">&#8226; eventType (string, exact class name)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="247.7891" x="17" y="612.1367">&#8226; eventSequence (zero-based index)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="156.7412" x="17" y="628.625">&#8226; documentId (UUIDv4)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="17" y="645.1133">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="263.7441" x="17" y="661.6016">See: docs/reference/event_schema.md</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="17" y="678.0898">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="239.3262" x="17" y="694.5781">Provider Integration (Decision 7):</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="292.0791" x="17" y="711.0664">Tool state changes trigger notifyListeners()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="272.9385" x="17" y="727.5547">via ToolManager to update UI reactively.</text></g><path d="M19.5,760.2978 L1368.641,760.2978 A12.5,12.5 0 0 1 1381.141,772.7978 L1381.141,786.7861 L7,786.7861 L7,772.7978 A12.5,12.5 0 0 1 19.5,760.2978" fill="#F1F1F1"/><rect fill="none" height="1273.545" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="1374.141" x="7" y="760.2978"/><line style="stroke:#181818;stroke-width:0.5;" x1="7" x2="1381.141" y1="786.7861" y2="786.7861"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95.457" x="646.342" y="778.833">Selection Tool</text><g id="SelectionTool.S_Idle"><rect fill="#F1F1F1" height="78.8867" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="206.4043" x="818.46" y="1725.6561"/><line style="stroke:#181818;stroke-width:0.5;" x1="818.46" x2="1024.8643" y1="1752.1444" y2="1752.1444"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.6201" x="878.8521" y="1744.1912">SelectionIdle</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="186.4043" x="823.46" y="1768.7459">Tool activated, waiting for input</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="109.3359" x="823.46" y="1782.8787">No selection active</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141.9434" x="823.46" y="1797.0116">Hover detection enabled</text></g><g id="SelectionTool.S_Hover"><rect fill="#F1F1F1" height="78.8867" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="188.3457" x="1006.49" y="1944.9561"/><line style="stroke:#181818;stroke-width:0.5;" x1="1006.49" x2="1194.8357" y1="1971.4444" y2="1971.4444"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.5908" x="1050.3674" y="1963.4912">SelectionHover</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="168.3457" x="1011.49" y="1988.0459">Mouse over selectable object</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="155.5137" x="1011.49" y="2002.1787">Preview selection highlight</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="129.252" x="1011.49" y="2016.3116">Cursor: pointer (hand)</text></g><g id="SelectionTool.S_Down"><rect fill="#F1F1F1" height="107.1523" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="227.7793" x="845.77" y="871.6961"/><line style="stroke:#181818;stroke-width:0.5;" x1="845.77" x2="1073.5493" y1="898.1844" y2="898.1844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147.3281" x="885.9956" y="890.2312">SelectionPointerDown</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="207.7793" x="850.77" y="914.7859">Pointer pressed on object or canvas</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144.1641" x="850.77" y="928.9187">Track drag start position</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="132.498" x="850.77" y="943.0516">Determine action type:</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="129.1348" x="850.77" y="957.1844">&#8226; Object click = select</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="180.5684" x="850.77" y="971.3172">&#8226; Canvas click = marquee start</text></g><g id="SelectionTool.S_Drag"><rect fill="#F1F1F1" height="121.2852" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="247.3262" x="19" y="1233.9061"/><line style="stroke:#181818;stroke-width:0.5;" x1="19" x2="266.3262" y1="1260.3944" y2="1260.3944"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.7988" x="80.7637" y="1252.4412">SelectionDragging</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="151.3242" x="24" y="1276.9959">Dragging selected objects</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="204.1055" x="24" y="1291.1287">OR drawing marquee selection box</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="13.8867" x="24" y="1305.2616">--</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="94.5996" x="24" y="1319.3944">Sampled Events:</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="201.5098" x="24" y="1333.5272">&#8226; MoveObjectEvent (50ms interval)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="227.3262" x="24" y="1347.66">&#8226; OR MarqueeUpdateEvent (visual only)</text></g><g id="SelectionTool.S_Commit"><rect fill="#F1F1F1" height="78.8867" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="231.2188" x="160.05" y="1536.3461"/><line style="stroke:#181818;stroke-width:0.5;" x1="160.05" x2="391.2688" y1="1562.8344" y2="1562.8344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.6387" x="218.34" y="1554.8813">SelectionCommit</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="211.2188" x="165.05" y="1579.4359">Finalize selection or move operation</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="210.9199" x="165.05" y="1593.5688">Emit EndGroupEvent for undo group</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="94.1367" x="165.05" y="1607.7016">Reset drag state</text></g><ellipse cx="921.66" cy="1575.7861" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><g class="entity" data-entity="GMN2" data-source-line="79" data-uid="ent0003" id="entity_GMN2"><path d="M1091.75,797.7861 L1091.75,921.2761 L1073.88,925.2761 L1091.75,929.2761 L1091.75,1052.7548 A0,0 0 0 0 1091.75,1052.7548 L1371.5757,1052.7548 A0,0 0 0 0 1371.5757,1052.7548 L1371.5757,807.7861 L1361.5757,797.7861 L1091.75,797.7861 A0,0 0 0 0 1091.75,797.7861" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1361.5757,797.7861 L1361.5757,807.7861 L1371.5757,807.7861 L1361.5757,797.7861" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="169.438" x="1097.75" y="815.3545">Click Selection (No Drag):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1097.75" y="830.665">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258.8257" x="1097.75" y="845.9755">Guard: drag distance less than 5.0 pixels</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1097.75" y="861.2861">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235.7837" x="1097.75" y="876.5966">Single click emits SelectObjectsEvent:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.2075" x="1097.75" y="891.9072">- objectIds: [clicked object ID]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.3433" x="1097.75" y="907.2177">- mode: "replace" (default)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.2378" x="1097.75" y="922.5283">- mode: "add" (Shift pressed)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.064" x="1097.75" y="937.8388">- mode: "toggle" (Cmd or Ctrl pressed)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1097.75" y="953.1494">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111.084" x="1097.75" y="968.4599">Event Definition:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.8589" x="1097.75" y="983.7705">eventType: "SelectObjectsEvent"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.6548" x="1097.75" y="999.081">Required: objectIds, mode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.2979" x="1097.75" y="1014.3916">Optional: undoGroupId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1097.75" y="1029.7021">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216.2393" x="1097.75" y="1045.0127">No undo grouping for single click.</text></g><g class="entity" data-entity="GMN5" data-source-line="100" data-uid="ent0006" id="entity_GMN5"><path d="M820.1,1182.3761 L820.1,1406.7237 L1099.2274,1406.7237 L1099.2274,1192.3761 L1089.2274,1182.3761 L820.1,1182.3761" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1089.2274,1182.3761 L1089.2274,1192.3761 L1099.2274,1192.3761 L1089.2274,1182.3761" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149.9063" x="826.1" y="1199.9445">Drag Operation Starts:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="826.1" y="1215.255">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.9487" x="826.1" y="1230.5655">Guard: drag distance &gt;= 5.0 pixels</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="826.1" y="1245.8761">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.1504" x="826.1" y="1261.1866">Emit StartGroupEvent:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.4463" x="826.1" y="1276.4972">- groupId: unique UUID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.9966" x="826.1" y="1291.8077">- description: "Move objects"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.8911" x="834.3266" y="1307.1183">OR "Marquee selection"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="826.1" y="1322.4288">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115.502" x="826.1" y="1337.7394">Two drag modes:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.1558" x="826.1" y="1353.0499">1. Move selected objects</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.0898" x="838.4398" y="1368.3605">&#8594; MoveObjectEvent (sampled)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.4365" x="826.1" y="1383.671">2. Draw marquee box</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.7876" x="838.4398" y="1398.9816">&#8594; MarqueeUpdateEvent (not persisted)</text></g><g class="entity" data-entity="GMN8" data-source-line="119" data-uid="ent0009" id="entity_GMN8"><path d="M469.81,1151.7561 L469.81,1290.5561 L266.72,1294.5561 L469.81,1298.5561 L469.81,1437.3459 A0,0 0 0 0 469.81,1437.3459 L763.5117,1437.3459 A0,0 0 0 0 763.5117,1437.3459 L763.5117,1161.7561 L753.5117,1151.7561 L469.81,1151.7561 A0,0 0 0 0 469.81,1151.7561" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M753.5117,1151.7561 L753.5117,1161.7561 L763.5117,1161.7561 L753.5117,1151.7561" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="145.2598" x="475.81" y="1169.3245">Sampled Drag Events:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="475.81" y="1184.635">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272.7017" x="475.81" y="1199.9455">During object move, emit MoveObjectEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.8643" x="475.81" y="1215.2561">at 50ms intervals (Decision 5):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="475.81" y="1230.5666">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.6201" x="475.81" y="1245.8772">eventType: "MoveObjectEvent"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.332" x="475.81" y="1261.1877">Required: objectIds, delta</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.6685" x="475.81" y="1276.4983">Optional: samplingIntervalMs (50)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.2979" x="475.81" y="1291.8088">Optional: undoGroupId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="475.81" y="1307.1194">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228.9282" x="475.81" y="1322.4299">Delta is incremental from last event,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.2266" x="475.81" y="1337.7405">not from drag start.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="475.81" y="1353.051">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.5688" x="475.81" y="1368.3616">Marquee Mode:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.0464" x="475.81" y="1383.6721">Marquee selection does NOT emit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243.3184" x="475.81" y="1398.9827">sampled events&#8212;only visual feedback.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204.585" x="475.81" y="1414.2932">Final SelectObjectsEvent emitted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.0605" x="475.81" y="1429.6037">on pointer up.</text></g><g class="entity" data-entity="GMN11" data-source-line="144" data-uid="ent0012" id="entity_GMN11"><path d="M109.52,1668.2361 L109.52,1861.9627 A0,0 0 0 0 109.52,1861.9627 L441.8091,1861.9627 A0,0 0 0 0 441.8091,1861.9627 L441.8091,1678.2361 L431.8091,1668.2361 L279.66,1668.2361 L275.66,1615.5961 L271.66,1668.2361 L109.52,1668.2361 A0,0 0 0 0 109.52,1668.2361" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M431.8091,1668.2361 L431.8091,1678.2361 L441.8091,1678.2361 L431.8091,1668.2361" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163.3125" x="115.52" y="1685.8045">Commit Drag Operation:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="115.52" y="1701.115">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119.8438" x="115.52" y="1716.4255">If moving objects:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248.9424" x="115.52" y="1731.7361">1. Final MoveObjectEvent (no sampling)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311.2891" x="115.52" y="1747.0466">2. EndGroupEvent (groupId, undoGroupEnd: true)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.7256" x="115.52" y="1762.3572">3. Flush events to persistence</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="115.52" y="1777.6677">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="140.0928" x="115.52" y="1792.9783">If marquee selection:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298.6128" x="115.52" y="1808.2888">1. SelectObjectsEvent (objectIds from marquee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.6392" x="115.52" y="1823.5994">2. EndGroupEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="115.52" y="1838.9099">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.4067" x="115.52" y="1854.2205">Entire drag is one undo group.</text></g><g class="entity" data-entity="GMN14" data-source-line="161" data-uid="ent0015" id="entity_GMN14"><path d="M513.17,1706.5061 L513.17,1823.6799 A0,0 0 0 0 513.17,1823.6799 L800.1622,1823.6799 A0,0 0 0 0 800.1622,1823.6799 L800.1622,1769.0961 L818.05,1765.0961 L800.1622,1761.0961 L800.1622,1716.5061 L790.1622,1706.5061 L513.17,1706.5061 A0,0 0 0 0 513.17,1706.5061" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M790.1622,1706.5061 L790.1622,1716.5061 L800.1622,1716.5061 L790.1622,1706.5061" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160.5449" x="519.17" y="1724.0745">Delete Selected Objects:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="519.17" y="1739.385">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265.9922" x="519.17" y="1754.6955">Delete key pressed while objects selected:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.2104" x="519.17" y="1770.0061">- Emit DeleteObjectsEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238.9448" x="519.17" y="1785.3166">- objectIds: currently selected objects</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.5698" x="519.17" y="1800.6272">- Single event, no undo group needed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115.7305" x="527.3966" y="1815.9377">(atomic operation)</text></g><!--link *start*SelectionTool to S_Idle--><g class="link" data-entity-1=".start.SelectionTool" data-entity-2="S_Idle" data-source-line="66" data-uid="lnk3" id="link_.start.SelectionTool_S_Idle"><path d="M921.66,1586.0761 C921.66,1611.1061 921.66,1675.0261 921.66,1719.4261" fill="none" id="*start*SelectionTool-to-S_Idle" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="921.66,1725.4261,925.66,1716.4261,921.66,1720.4261,917.66,1716.4261,921.66,1725.4261" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.769" x="922.66" y="1646.8045">onActivate()</text></g><!--link S_Idle to S_Hover--><g class="link" data-entity-1="S_Idle" data-entity-2="S_Hover" data-source-line="68" data-uid="lnk4" id="link_S_Idle_S_Hover"><path d="M997.32,1804.9161 C1026.94,1823.7461 1058.57,1849.0461 1078.66,1879.9561 C1091.07,1899.0461 1095.9161,1917.9575 1098.3461,1938.5275" fill="none" id="S_Idle-to-S_Hover" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1099.05,1944.4861,1101.9665,1935.079,1098.4634,1939.5206,1094.0218,1936.0175,1099.05,1944.4861" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6279" x="1114.6949" y="1893.5245">onPointerMove</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.1177" x="1096.95" y="1908.835">[hover over object] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.8071" x="1117.6053" y="1924.1455">update cursor</text></g><!--link S_Hover to S_Idle--><g class="link" data-entity-1="S_Hover" data-entity-2="S_Idle" data-source-line="70" data-uid="lnk5" id="link_S_Hover_S_Idle"><path d="M1006.43,1976.7361 C973.26,1969.3061 939.17,1954.7861 918.66,1926.9561 C892.9,1891.9961 898.0291,1845.9628 907.2191,1810.6428" fill="none" id="S_Hover-to-S_Idle" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="908.73,1804.8361,902.5926,1812.5389,907.471,1809.675,910.3348,1814.5533,908.73,1804.8361" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6279" x="950.0558" y="1893.5245">onPointerMove</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.4194" x="919.66" y="1908.835">[no longer over object] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75.3848" x="959.1773" y="1924.1455">reset cursor</text></g><!--link S_Hover to S_Down--><g class="link" data-entity-1="S_Hover" data-entity-2="S_Down" data-source-line="72" data-uid="lnk6" id="link_S_Hover_S_Down"><path d="M1195.04,1954.8861 C1208.41,1947.5261 1220.9,1938.3561 1230.66,1926.9561 C1278.73,1870.8361 1272.66,1839.9861 1272.66,1766.0961 C1272.66,1293.5561 1272.66,1293.5561 1272.66,1293.5561 C1272.66,1157.2261 1179.69,1148.5161 1082.66,1052.7561 C1058.47,1028.8761 1036.2984,1006.2317 1014.2184,983.3717" fill="none" id="S_Hover-to-S_Down" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1010.05,979.0561,1013.4255,988.3085,1013.5236,982.6525,1019.1796,982.7506,1010.05,979.0561" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.2813" x="1274.2599" y="1565.8545">onPointerDown</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78.438" x="1283.1815" y="1581.165">[on object] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.481" x="1273.66" y="1596.4755">track drag start</text></g><!--link S_Idle to S_Down--><g class="link" data-entity-1="S_Idle" data-entity-2="S_Down" data-source-line="74" data-uid="lnk7" id="link_S_Idle_S_Down"><path d="M902.27,1725.4161 C855.91,1627.6361 747.07,1363.3461 810.66,1151.7561 C830.38,1086.1461 872.2413,1026.6557 907.8713,983.6657" fill="none" id="S_Idle-to-S_Down" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="911.7,979.0461,902.8772,983.423,908.5094,982.8958,909.0367,988.528,911.7,979.0461" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.2813" x="825.55" y="1476.9145">onPointerDown</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81.9927" x="832.6943" y="1492.225">[on canvas] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.334" x="829.5236" y="1507.5355">start marquee</text></g><!--link S_Down to S_Idle--><g class="link" data-entity-1="S_Down" data-entity-2="S_Idle" data-source-line="76" data-uid="lnk8" id="link_S_Down_S_Idle"><path d="M1007.63,979.0461 C1043.25,1022.0361 1088.94,1086.1461 1108.66,1151.7561 C1145.2,1273.3161 1137.95,1313.8461 1108.66,1437.3461 C1081.44,1552.1361 1003.36,1662.7885 957.48,1720.8485" fill="none" id="S_Down-to-S_Idle" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="953.76,1725.5561,962.4784,1720.9747,956.86,1721.6331,956.2016,1716.0147,953.76,1725.5561" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.6636" x="1130.3179" y="1468.9145">onPointerUp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.8193" x="1104.74" y="1484.225">[drag distance &lt; 5.0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.6343" x="1115.8325" y="1499.5355">AND on object] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.3394" x="1109.98" y="1514.8461">SelectObjectsEvent</text></g><!--link S_Down to S_Drag--><g class="link" data-entity-1="S_Down" data-entity-2="S_Drag" data-source-line="97" data-uid="lnk9" id="link_S_Down_S_Drag"><path d="M845.45,974.0461 C779.77,1001.7761 695.82,1037.6661 621.66,1070.7561 C500.43,1124.8461 368.5753,1186.4337 272.1553,1231.9737" fill="none" id="S_Down-to-S_Drag" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="266.73,1234.5361,276.5762,1234.3093,271.2511,1232.4007,273.1597,1227.0756,266.73,1234.5361" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6279" x="653.0018" y="1084.3245">onPointerMove</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.3115" x="622.66" y="1099.635">[drag distance &gt;= 5.0] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.2344" x="646.6986" y="1114.9455">StartGroupEvent,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.6621" x="631.9847" y="1130.2561">set isDragging = true</text></g><!--link S_Drag to S_Drag--><g class="link" data-entity-1="S_Drag" data-entity-2="S_Drag" data-source-line="116" data-uid="lnk10" id="link_S_Drag_S_Drag"><path d="M266.52,1266.1561 C277.47,1272.1261 284.33,1281.5961 284.33,1294.5561 C284.33,1307.5061 282.7379,1314.104 271.7879,1320.074" fill="none" id="S_Drag-to-S_Drag" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="266.52,1322.9461,276.3366,1322.1499,270.9099,1320.5527,272.5072,1315.126,266.52,1322.9461" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104.5586" x="315.8825" y="1284.6245">onPointerMove /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.1006" x="314.1115" y="1299.935">MoveObjectEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.6636" x="290.33" y="1315.2455">(samplingIntervalMs: 50)</text></g><!--link S_Drag to S_Commit--><g class="link" data-entity-1="S_Drag" data-entity-2="S_Commit" data-source-line="139" data-uid="lnk11" id="link_S_Drag_S_Commit"><path d="M171.19,1355.4561 C197.22,1410.0961 232.3396,1483.8293 254.6196,1530.5993" fill="none" id="S_Drag-to-S_Commit" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="257.2,1536.0161,256.9406,1526.1707,255.0497,1531.5021,249.7182,1529.6112,257.2,1536.0161" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.5942" x="307.3509" y="1468.9145">onPointerUp /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.416" x="247.94" y="1484.225">if moving: final MoveObjectEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.5874" x="254.3543" y="1499.5355">if marquee: SelectObjectsEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.1924" x="303.5518" y="1514.8461">EndGroupEvent</text></g><!--link S_Commit to S_Idle--><g class="link" data-entity-1="S_Commit" data-entity-2="S_Idle" data-source-line="141" data-uid="lnk12" id="link_S_Commit_S_Idle"><path d="M391.62,1597.6561 C475.68,1612.6561 592.13,1633.1561 694.66,1650.2361 C745.26,1658.6561 762.04,1646.8461 808.66,1668.2361 C838.13,1681.7461 861.6803,1700.9809 882.3503,1721.2909" fill="none" id="S_Commit-to-S_Idle" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="886.63,1725.4961,883.0139,1716.3351,883.0635,1721.9918,877.4069,1722.0414,886.63,1725.4961" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81.8276" x="695.66" y="1646.8045">/ resetState()</text></g><!--link S_Idle to S_Idle--><g class="link" data-entity-1="S_Idle" data-entity-2="S_Idle" data-source-line="158" data-uid="lnk13" id="link_S_Idle_S_Idle"><path d="M1025.11,1745.9361 C1035.93,1749.6761 1042.87,1756.0561 1042.87,1765.0961 C1042.87,1774.1361 1041.6008,1778.556 1030.7808,1782.296" fill="none" id="S_Idle-to-S_Idle" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1025.11,1784.2561,1034.9229,1785.0964,1029.8357,1782.6226,1032.3094,1777.5354,1025.11,1784.2561" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.5762" x="1073.9115" y="1755.1645">onKeyPress</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.2173" x="1067.0909" y="1770.475">[Delete key] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.6592" x="1048.87" y="1785.7855">DeleteObjectsEvent</text></g><!--link GMN5 to S_Drag--><g class="link" data-entity-1="GMN5" data-entity-2="S_Drag" data-source-line="100" data-uid="lnk7" id="link_GMN5_S_Drag"><path d="M891.5,1182.0261 C866.05,1150.2361 834.09,1119.5961 796.66,1102.2561 C664.79,1041.1661 609.89,1064.0761 469.66,1102.2561 C376.25,1127.6861 282.29,1187.3161 219.22,1233.4861" fill="none" id="GMN5-S_Drag" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g><path d="M1428.58,806.5678 L2845.5604,806.5678 A12.5,12.5 0 0 1 2858.0604,819.0678 L2858.0604,833.0561 L1416.08,833.0561 L1416.08,819.0678 A12.5,12.5 0 0 1 1428.58,806.5678" fill="#F1F1F1"/><rect fill="none" height="1180.995" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="1441.9804" x="1416.08" y="806.5678"/><line style="stroke:#181818;stroke-width:0.5;" x1="1416.08" x2="2858.0604" y1="833.0561" y2="833.0561"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.3555" x="2066.8925" y="825.103">Direct Selection Tool</text><g id="DirectSelectionTool.DS_Idle"><rect fill="#F1F1F1" height="78.8867" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="216.7285" x="2192.96" y="1709.9961"/><line style="stroke:#181818;stroke-width:0.5;" x1="2192.96" x2="2409.6885" y1="1736.4844" y2="1736.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7178" x="2279.9654" y="1728.5313">DSIdle</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="186.4043" x="2197.96" y="1753.0859">Tool activated, waiting for input</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="196.7285" x="2197.96" y="1767.2188">Hover detection for anchors/BCPs</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="152.0508" x="2197.96" y="1781.3516">Cursor: crosshair (default)</text></g><g id="DirectSelectionTool.DS_Hover"><rect fill="#F1F1F1" height="78.8867" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="210.2246" x="2338.22" y="1898.6761"/><line style="stroke:#181818;stroke-width:0.5;" x1="2338.22" x2="2548.4446" y1="1925.1644" y2="1925.1644"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57.6885" x="2414.4881" y="1917.2112">DSHover</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="186.5156" x="2343.22" y="1941.7659">Mouse over anchor point or BCP</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143.584" x="2343.22" y="1955.8987">Preview anchor highlight</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="190.2246" x="2343.22" y="1970.0316">Cursor: move (hand with arrows)</text></g><g id="DirectSelectionTool.DS_Down"><rect fill="#F1F1F1" height="78.8867" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="200.9141" x="2362.87" y="924.4461"/><line style="stroke:#181818;stroke-width:0.5;" x1="2362.87" x2="2563.7841" y1="950.9344" y2="950.9344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.4258" x="2411.1141" y="942.9813">DSPointerDown</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="180.9141" x="2367.87" y="967.5359">Pointer pressed on anchor/BCP</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144.1641" x="2367.87" y="981.6688">Track drag start position</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="159.8906" x="2367.87" y="995.8016">Store anchor/BCP metadata</text></g><g id="DirectSelectionTool.DS_Drag"><rect fill="#F1F1F1" height="107.1523" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="236.498" x="1428.08" y="1271.9361"/><line style="stroke:#181818;stroke-width:0.5;" x1="1428.08" x2="1664.578" y1="1298.4244" y2="1298.4244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.8965" x="1505.8808" y="1290.4713">DSDragging</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="216.498" x="1433.08" y="1315.0259">Dragging anchor point or BCP handle</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="192.1465" x="1433.08" y="1329.1588">Live preview of path deformation</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="13.8867" x="1433.08" y="1343.2916">--</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="94.5996" x="1433.08" y="1357.4244">Sampled Events:</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="214.0723" x="1433.08" y="1371.5572">&#8226; ModifyAnchorEvent (50ms interval)</text></g><g id="DirectSelectionTool.DS_Commit"><rect fill="#F1F1F1" height="78.8867" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="230.9199" x="1794.87" y="1551.3061"/><line style="stroke:#181818;stroke-width:0.5;" x1="1794.87" x2="2025.7899" y1="1577.7944" y2="1577.7944"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71.7363" x="1874.4618" y="1569.8413">DSCommit</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="193.1777" x="1799.87" y="1594.3959">Finalize anchor/BCP modification</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="171.0293" x="1799.87" y="1608.5288">Emit final ModifyAnchorEvent</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="210.9199" x="1799.87" y="1622.6616">Emit EndGroupEvent for undo group</text></g><ellipse cx="2301.33" cy="1590.7561" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><g class="entity" data-entity="GMN17" data-source-line="219" data-uid="ent0018" id="entity_GMN17"><path d="M2581.6,844.0561 L2581.6,959.8861 L2564.23,963.8861 L2581.6,967.8861 L2581.6,1083.7143 A0,0 0 0 0 2581.6,1083.7143 L2849.0604,1083.7143 A0,0 0 0 0 2849.0604,1083.7143 L2849.0604,854.0561 L2839.0604,844.0561 L2581.6,844.0561 A0,0 0 0 0 2581.6,844.0561" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2839.0604,844.0561 L2839.0604,854.0561 L2849.0604,854.0561 L2839.0604,844.0561" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152.5659" x="2587.6" y="861.6245">Click Anchor Selection:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2587.6" y="876.935">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.6147" x="2587.6" y="892.2455">Guard: drag distance &lt; 5.0 pixels</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2587.6" y="907.5561">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.4375" x="2587.6" y="922.8666">Emit SelectAnchorsEvent:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.3389" x="2587.6" y="938.1772">- pathId: parent path</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246.4604" x="2587.6" y="953.4877">- anchorIndices: [clicked anchor index]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.3433" x="2587.6" y="968.7983">- mode: "replace" (default)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.2378" x="2587.6" y="984.1088">- mode: "add" (Shift pressed)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2587.6" y="999.4194">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111.084" x="2587.6" y="1014.7299">Event Definition:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204.9277" x="2587.6" y="1030.0405">eventType: "SelectAnchorsEvent"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244.2197" x="2587.6" y="1045.351">Required: pathId, anchorIndices, mode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2587.6" y="1060.6616">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.0615" x="2587.6" y="1075.9721">Single click, no undo group.</text></g><g class="entity" data-entity="GMN20" data-source-line="239" data-uid="ent0021" id="entity_GMN20"><path d="M2157.54,1243.9561 L2157.54,1407.0616 L2435.1123,1407.0616 L2435.1123,1253.9561 L2425.1123,1243.9561 L2157.54,1243.9561" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2425.1123,1243.9561 L2425.1123,1253.9561 L2435.1123,1253.9561 L2425.1123,1243.9561" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149.9063" x="2163.54" y="1261.5245">Drag Operation Starts:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2163.54" y="1276.835">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.9487" x="2163.54" y="1292.1455">Guard: drag distance &gt;= 5.0 pixels</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2163.54" y="1307.4561">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.1504" x="2163.54" y="1322.7666">Emit StartGroupEvent:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.4463" x="2163.54" y="1338.0772">- groupId: unique UUID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.3027" x="2163.54" y="1353.3877">- description: "Modify anchor"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.0239" x="2171.7666" y="1368.6983">OR "Adjust Bezier handle"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2163.54" y="1384.0088">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256.5723" x="2163.54" y="1399.3194">Begin 50ms sampling for smooth replay.</text></g><g class="entity" data-entity="GMN23" data-source-line="254" data-uid="ent0024" id="entity_GMN23"><path d="M1867.42,1182.7161 L1867.42,1321.5161 L1665.04,1325.5161 L1867.42,1329.5161 L1867.42,1468.3059 A0,0 0 0 0 1867.42,1468.3059 L2139.2476,1468.3059 A0,0 0 0 0 2139.2476,1468.3059 L2139.2476,1192.7161 L2129.2476,1182.7161 L1867.42,1182.7161 A0,0 0 0 0 1867.42,1182.7161" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2129.2476,1182.7161 L2129.2476,1192.7161 L2139.2476,1192.7161 L2129.2476,1182.7161" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="199.7671" x="1873.42" y="1200.2845">Sampled Anchor Modification:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1873.42" y="1215.595">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238.0054" x="1873.42" y="1230.9055">During drag, emit ModifyAnchorEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.8643" x="1873.42" y="1246.2161">at 50ms intervals (Decision 5):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1873.42" y="1261.5266">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204.2295" x="1873.42" y="1276.8372">eventType: "ModifyAnchorEvent"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250.8276" x="1873.42" y="1292.1477">Required: pathId, anchorIndex, position</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.1821" x="1873.42" y="1307.4583">Optional: handleIn, handleOut</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.6685" x="1873.42" y="1322.7688">Optional: samplingIntervalMs (50)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.2979" x="1873.42" y="1338.0794">Optional: undoGroupId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1873.42" y="1353.3899">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111.3633" x="1873.42" y="1368.7005">Modifier: Alt Key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214.9951" x="1873.42" y="1384.011">- Not pressed: Symmetric handles</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.375" x="1881.6466" y="1399.3216">(handleIn = -handleOut)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.6113" x="1873.42" y="1414.6321">- Pressed: Independent handles</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.9888" x="1881.6466" y="1429.9427">(handleIn unchanged, only handleOut)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1873.42" y="1445.2532">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.3374" x="1873.42" y="1460.5637">Position is absolute, not delta.</text></g><g class="entity" data-entity="GMN26" data-source-line="279" data-uid="ent0027" id="entity_GMN26"><path d="M1744.18,1683.1961 L1744.18,1815.6805 A0,0 0 0 0 1744.18,1815.6805 L2076.4691,1815.6805 A0,0 0 0 0 2076.4691,1815.6805 L2076.4691,1693.1961 L2066.4691,1683.1961 L1914.33,1683.1961 L1910.33,1630.4861 L1906.33,1683.1961 L1744.18,1683.1961 A0,0 0 0 0 1744.18,1683.1961" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2066.4691,1683.1961 L2066.4691,1693.1961 L2076.4691,1693.1961 L2066.4691,1683.1961" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="195.292" x="1750.18" y="1700.7645">Commit Anchor Modification:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1750.18" y="1716.075">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262.5518" x="1750.18" y="1731.3855">1. Final ModifyAnchorEvent (no sampling)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311.2891" x="1750.18" y="1746.6961">2. EndGroupEvent (groupId, undoGroupEnd: true)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.7256" x="1750.18" y="1762.0066">3. Flush events to persistence</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1750.18" y="1777.3172">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.4067" x="1750.18" y="1792.6277">Entire drag is one undo group.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265.6685" x="1750.18" y="1807.9383">Undo reverts anchor to pre-drag position.</text></g><!--link *start*DirectSelectionTool to DS_Idle--><g class="link" data-entity-1=".start.DirectSelectionTool" data-entity-2="DS_Idle" data-source-line="208" data-uid="lnk15" id="link_.start.DirectSelectionTool_DS_Idle"><path d="M2301.33,1601.0861 C2301.33,1621.9661 2301.33,1667.4761 2301.33,1703.6861" fill="none" id="*start*DirectSelectionTool-to-DS_Idle" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="2301.33,1709.6861,2305.33,1700.6861,2301.33,1704.6861,2297.33,1700.6861,2301.33,1709.6861" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.769" x="2302.33" y="1661.7645">onActivate()</text></g><!--link DS_Idle to DS_Hover--><g class="link" data-entity-1="DS_Idle" data-entity-2="DS_Hover" data-source-line="210" data-uid="lnk16" id="link_DS_Idle_DS_Hover"><path d="M2376.01,1789.3161 C2393.16,1801.4261 2409.74,1816.2661 2421.33,1833.6761 C2434.04,1852.7861 2438.9032,1871.9344 2441.2532,1892.6344" fill="none" id="DS_Idle-to-DS_Hover" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="2441.93,1898.5961,2444.8893,1889.2023,2441.366,1893.628,2436.9403,1890.1047,2441.93,1898.5961" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6279" x="2474.9787" y="1847.2445">onPointerMove</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163.9854" x="2439.8" y="1862.555">[hover over anchor/BCP] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.8071" x="2477.8891" y="1877.8655">update cursor</text></g><!--link DS_Hover to DS_Idle--><g class="link" data-entity-1="DS_Hover" data-entity-2="DS_Idle" data-source-line="212" data-uid="lnk17" id="link_DS_Hover_DS_Idle"><path d="M2337.96,1922.1361 C2290,1912.9361 2240.73,1899.3061 2226.33,1880.6761 C2204.14,1851.9861 2223.9381,1820.3193 2250.5281,1793.4693" fill="none" id="DS_Hover-to-DS_Idle" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="2254.75,1789.2061,2245.5749,1792.7863,2251.2317,1792.7588,2251.2592,1798.4156,2254.75,1789.2061" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6279" x="2275.1596" y="1847.2445">onPointerMove</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.2871" x="2227.33" y="1862.555">[no longer over anchor/BCP] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75.3848" x="2284.2812" y="1877.8655">reset cursor</text></g><!--link DS_Hover to DS_Down--><g class="link" data-entity-1="DS_Hover" data-entity-2="DS_Down" data-source-line="214" data-uid="lnk18" id="link_DS_Hover_DS_Down"><path d="M2548.64,1919.9961 C2571.01,1911.6161 2592.36,1899.1661 2607.33,1880.6761 C2644.04,1835.3561 2623.33,1808.7561 2623.33,1750.4361 C2623.33,1324.5161 2623.33,1324.5161 2623.33,1324.5161 C2623.33,1198.2661 2543.546,1071.7762 2497.156,1008.4562" fill="none" id="DS_Hover-to-DS_Down" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="2493.61,1003.6161,2495.7022,1013.2402,2496.565,1007.6495,2502.1556,1008.5122,2493.61,1003.6161" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.2813" x="2632.8422" y="1580.8245">onPointerDown</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.3057" x="2624.33" y="1596.135">[on anchor/BCP] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.481" x="2632.2424" y="1611.4455">track drag start</text></g><!--link DS_Down to DS_Idle--><g class="link" data-entity-1="DS_Down" data-entity-2="DS_Idle" data-source-line="216" data-uid="lnk19" id="link_DS_Down_DS_Idle"><path d="M2465.43,1003.7961 C2469.23,1088.8261 2474.33,1297.3061 2444.33,1468.3061 C2428.45,1558.8061 2428.38,1586.2761 2381.33,1665.1961 C2371.78,1681.2061 2362.8331,1692.2942 2349.9331,1705.3742" fill="none" id="DS_Down-to-DS_Idle" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="2345.72,1709.6461,2354.8877,1706.047,2349.231,1706.0861,2349.1918,1700.4294,2345.72,1709.6461" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.6636" x="2475.077" y="1499.8745">onPointerUp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.9775" x="2441.92" y="1515.185">[drag distance &lt; 5.0] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.4082" x="2452.7047" y="1530.4955">SelectAnchorsEvent</text></g><!--link DS_Down to DS_Drag--><g class="link" data-entity-1="DS_Down" data-entity-2="DS_Drag" data-source-line="236" data-uid="lnk20" id="link_DS_Down_DS_Drag"><path d="M2362.56,998.3761 C2241.71,1039.1761 2033.49,1111.5161 1858.33,1182.7161 C1790.81,1210.1661 1721.907,1241.2786 1662.727,1268.8986" fill="none" id="DS_Down-to-DS_Drag" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1657.29,1271.4361,1667.1372,1271.2545,1661.8208,1269.3215,1663.7538,1264.0052,1657.29,1271.4361" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6279" x="2087.5918" y="1115.2845">onPointerMove</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.3115" x="2057.25" y="1130.595">[drag distance &gt;= 5.0] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.2344" x="2081.2886" y="1145.9055">StartGroupEvent,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.6621" x="2066.5747" y="1161.2161">set isDragging = true</text></g><!--link DS_Drag to DS_Drag--><g class="link" data-entity-1="DS_Drag" data-entity-2="DS_Drag" data-source-line="251" data-uid="lnk21" id="link_DS_Drag_DS_Drag"><path d="M1664.99,1298.0561 C1675.79,1303.7661 1682.58,1312.9161 1682.58,1325.5161 C1682.58,1338.1161 1681.0943,1344.4617 1670.2943,1350.1717" fill="none" id="DS_Drag-to-DS_Drag" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1664.99,1352.9761,1674.816,1352.3057,1669.4102,1350.6391,1671.0768,1345.2333,1664.99,1352.9761" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104.5586" x="1714.1325" y="1315.5845">onPointerMove /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.71" x="1705.5568" y="1330.895">ModifyAnchorEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.6636" x="1688.58" y="1346.2055">(samplingIntervalMs: 50)</text></g><!--link DS_Drag to DS_Commit--><g class="link" data-entity-1="DS_Drag" data-entity-2="DS_Commit" data-source-line="274" data-uid="lnk22" id="link_DS_Drag_DS_Commit"><path d="M1619.55,1379.4661 C1689.72,1430.2161 1789.1082,1502.0901 1851.8582,1547.4701" fill="none" id="DS_Drag-to-DS_Commit" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1856.72,1550.9861,1851.7712,1542.4708,1852.6685,1548.0561,1847.0832,1548.9533,1856.72,1550.9861" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.5942" x="1867.1524" y="1499.8745">onPointerUp /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.479" x="1832.71" y="1515.185">final ModifyAnchorEvent,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.1924" x="1863.3533" y="1530.4955">EndGroupEvent</text></g><!--link DS_Commit to DS_Idle--><g class="link" data-entity-1="DS_Commit" data-entity-2="DS_Idle" data-source-line="276" data-uid="lnk23" id="link_DS_Commit_DS_Idle"><path d="M2007.48,1630.6861 C2067.53,1654.7461 2138.7505,1683.2844 2198.7705,1707.3344" fill="none" id="DS_Commit-to-DS_Idle" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="2204.34,1709.5661,2197.4735,1702.5055,2199.6987,1707.7063,2194.4979,1709.9315,2204.34,1709.5661" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81.8276" x="2083.42" y="1661.7645">/ resetState()</text></g><!--link GMN20 to DS_Drag--><g class="link" data-entity-1="GMN20" data-entity-2="DS_Drag" data-source-line="239" data-uid="lnk22" id="link_GMN20_DS_Drag"><path d="M2252.98,1243.6361 C2226.26,1202.3261 2187.81,1156.2261 2139.33,1133.2161 C2030.11,1081.3961 1983.84,1100.9861 1867.33,1133.2161 C1770.44,1160.0161 1673.39,1224.6861 1611.78,1271.6461" fill="none" id="GMN20-DS_Drag" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g><path d="M2905.34,755.5078 L4366.797,755.5078 A12.5,12.5 0 0 1 4379.297,768.0078 L4379.297,781.9961 L2892.84,781.9961 L2892.84,768.0078 A12.5,12.5 0 0 1 2905.34,755.5078" fill="#F1F1F1"/><rect fill="none" height="1283.1225" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="1486.457" x="2892.84" y="755.5078"/><line style="stroke:#181818;stroke-width:0.5;" x1="2892.84" x2="4379.297" y1="781.9961" y2="781.9961"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58.7549" x="3606.691" y="774.043">Pen Tool</text><g id="PenTool.P_Idle"><rect fill="#F1F1F1" height="78.8867" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="232.3789" x="3475.53" y="976.9961"/><line style="stroke:#181818;stroke-width:0.5;" x1="3475.53" x2="3707.9089" y1="1003.4844" y2="1003.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48.918" x="3567.2605" y="995.5313">PenIdle</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="186.4043" x="3480.53" y="1020.0859">Tool activated, waiting for input</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="212.3789" x="3480.53" y="1034.2188">No active path (currentPathId = null)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="99.7676" x="3480.53" y="1048.3516">Cursor: crosshair</text></g><g id="PenTool.P_Creating"><rect fill="#F1F1F1" height="149.5508" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="250.6836" x="3467.38" y="1325.9461"/><line style="stroke:#181818;stroke-width:0.5;" x1="3467.38" x2="3718.0636" y1="1352.4344" y2="1352.4344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.2686" x="3537.0875" y="1344.4813">PenCreatingPath</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148.5176" x="3472.38" y="1369.0359">Active path being created</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="176.584" x="3472.38" y="1383.1688">Placing anchors and segments</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="230.6836" x="3472.38" y="1397.3016">Preview next segment to hover position</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="13.8867" x="3472.38" y="1411.4344">--</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="86.0508" x="3472.38" y="1425.5672">Pointer Events:</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="208.9746" x="3472.38" y="1439.7">&#8226; onPointerDown &#8594; track drag start</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="205.4531" x="3472.38" y="1453.8328">&#8226; onPointerMove &#8594; update preview</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="206.7129" x="3472.38" y="1467.9656">&#8226; onPointerUp &#8594; emit anchor event</text></g><g id="PenTool.P_Adjusting"><rect fill="#F1F1F1" height="135.418" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="251.2637" x="3295.09" y="1755.8761"/><line style="stroke:#181818;stroke-width:0.5;" x1="3295.09" x2="3546.3537" y1="1782.3644" y2="1782.3644"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143.9854" x="3348.7292" y="1774.4113">PenAdjustingHandles</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="231.2637" x="3300.09" y="1798.9659">Adjusting Bezier handles on last anchor</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="180.5801" x="3300.09" y="1813.0988">Clicked on last anchor position</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="194.4668" x="3300.09" y="1827.2316">Dragging to adjust control points</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="13.8867" x="3300.09" y="1841.3644">--</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="98.0391" x="3300.09" y="1855.4972">Alt Key Behavior:</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198.2402" x="3300.09" y="1869.63">&#8226; Not pressed: Symmetric handles</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184.9629" x="3300.09" y="1883.7628">&#8226; Pressed: Independent handles</text></g><ellipse cx="3591.72" cy="802.9961" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><g class="entity" data-entity="GMN29" data-source-line="327" data-uid="ent0030" id="entity_GMN29"><path d="M3726.35,865.9961 L3726.35,1012.4461 L3708.39,1016.4461 L3726.35,1020.4461 L3726.35,1166.8965 A0,0 0 0 0 3726.35,1166.8965 L3981.0897,1166.8965 A0,0 0 0 0 3981.0897,1166.8965 L3981.0897,875.9961 L3971.0897,865.9961 L3726.35,865.9961 A0,0 0 0 0 3726.35,865.9961" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M3971.0897,865.9961 L3971.0897,875.9961 L3981.0897,875.9961 L3971.0897,865.9961" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="147.437" x="3732.35" y="883.5645">First Click Starts Path:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3732.35" y="898.875">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233.7397" x="3732.35" y="914.1855">Generate unique pathId and groupId.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3732.35" y="929.4961">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.3608" x="3732.35" y="944.8066">Emit sequence:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.6812" x="3732.35" y="960.1172">1. StartGroupEvent:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.9468" x="3744.6898" y="975.4277">- groupId: UUID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.4624" x="3744.6898" y="990.7383">- description: "Create path"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.8311" x="3744.6898" y="1006.0488">- undoGroupStart: true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3732.35" y="1021.3594">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.6431" x="3732.35" y="1036.6699">2. CreatePathEvent:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.5776" x="3744.6898" y="1051.9805">- pathId: UUID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.9751" x="3744.6898" y="1067.291">- startAnchor: clicked position</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.7207" x="3744.6898" y="1082.6016">- strokeColor: #000000 (default)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.0415" x="3744.6898" y="1097.9121">- strokeWidth: 2.0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195.5776" x="3744.6898" y="1113.2227">- undoGroupId: same as above</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3732.35" y="1128.5332">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.4077" x="3732.35" y="1143.8438">Transition to creatingPath state.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.4258" x="3732.35" y="1159.1543">Track _lastAnchorPosition.</text></g><g class="entity" data-entity="GMN32" data-source-line="351" data-uid="ent0033" id="entity_GMN32"><path d="M2903.84,1280.8961 L2903.84,1520.5543 L3165.6003,1520.5543 L3165.6003,1290.8961 L3155.6003,1280.8961 L2903.84,1280.8961" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M3155.6003,1280.8961 L3155.6003,1290.8961 L3165.6003,1290.8961 L3155.6003,1280.8961" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="171.4438" x="2909.84" y="1298.4645">Add Straight Line Anchor:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2909.84" y="1313.775">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.6147" x="2909.84" y="1329.0855">Guard: drag distance &lt; 5.0 pixels</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2909.84" y="1344.3961">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.3784" x="2909.84" y="1359.7066">Emit AddAnchorEvent:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.5039" x="2909.84" y="1375.0172">- eventType: "AddAnchorEvent"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.0234" x="2909.84" y="1390.3277">- pathId: current path</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.8438" x="2909.84" y="1405.6383">- position: pointer position</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.1152" x="2909.84" y="1420.9488">- anchorType: "line"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.4971" x="2909.84" y="1436.2594">- undoGroupId: from StartGroupEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2909.84" y="1451.5699">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.7603" x="2909.84" y="1466.8805">No handleIn/handleOut (straight line).</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2909.84" y="1482.191">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="123.1445" x="2909.84" y="1497.5016">Modifier: Shift Key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227.3159" x="2909.84" y="1512.8121">Constrains angle to 45&#176; increments.</text></g><g class="entity" data-entity="GMN35" data-source-line="371" data-uid="ent0036" id="entity_GMN35"><path d="M4093.15,1280.8961 L4093.15,1396.7261 L3718.46,1400.7261 L4093.15,1404.7261 L4093.15,1520.5543 A0,0 0 0 0 4093.15,1520.5543 L4370.297,1520.5543 A0,0 0 0 0 4370.297,1520.5543 L4370.297,1290.8961 L4360.297,1280.8961 L4093.15,1280.8961 A0,0 0 0 0 4093.15,1280.8961" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M4360.297,1280.8961 L4360.297,1290.8961 L4370.297,1290.8961 L4360.297,1280.8961" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="170.9233" x="4099.15" y="1298.4645">Add Bezier Curve Anchor:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="4099.15" y="1313.775">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.9487" x="4099.15" y="1329.0855">Guard: drag distance &gt;= 5.0 pixels</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="4099.15" y="1344.3961">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.3784" x="4099.15" y="1359.7066">Emit AddAnchorEvent:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.5039" x="4099.15" y="1375.0172">- eventType: "AddAnchorEvent"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.0234" x="4099.15" y="1390.3277">- pathId: current path</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244.0229" x="4099.15" y="1405.6383">- position: anchor position (drag start)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.4858" x="4099.15" y="1420.9488">- anchorType: "bezier"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256.147" x="4099.15" y="1436.2594">- handleOut: drag end - anchor position</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225.3228" x="4099.15" y="1451.5699">- handleIn: -handleOut (symmetric)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217.1025" x="4107.3766" y="1466.8805">OR null (Alt pressed, independent)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.4971" x="4099.15" y="1482.191">- undoGroupId: from StartGroupEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="4099.15" y="1497.5016">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="255.0615" x="4099.15" y="1512.8121">Drag direction determines initial handle.</text></g><g class="entity" data-entity="GMN38" data-source-line="391" data-uid="ent0039" id="entity_GMN38"><path d="M3026.11,1749.6961 L3026.11,1897.491 A0,0 0 0 0 3026.11,1897.491 L3277.3395,1897.491 A0,0 0 0 0 3277.3395,1897.491 L3277.3395,1827.5861 L3294.84,1823.5861 L3277.3395,1819.5861 L3277.3395,1759.6961 L3267.3395,1749.6961 L3026.11,1749.6961 A0,0 0 0 0 3026.11,1749.6961" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M3267.3395,1749.6961 L3267.3395,1759.6961 L3277.3395,1759.6961 L3267.3395,1749.6961" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="141.3687" x="3032.11" y="1767.2645">Click on Last Anchor:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3032.11" y="1782.575">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.2295" x="3032.11" y="1797.8855">Distance threshold: 10.0 world units</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3032.11" y="1813.1961">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.6577" x="3032.11" y="1828.5066">Enables user to adjust handles</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.6089" x="3032.11" y="1843.8172">after placing a Bezier anchor.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3032.11" y="1859.1277">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188.4429" x="3032.11" y="1874.4383">Checked BEFORE double-click</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188.9634" x="3032.11" y="1889.7488">detection to prevent conflicts.</text></g><g class="entity" data-entity="GMN41" data-source-line="405" data-uid="ent0042" id="entity_GMN41"><path d="M3564.47,1703.7561 L3564.47,1819.5861 L3546.75,1823.5861 L3564.47,1827.5861 L3564.47,1943.4143 A0,0 0 0 0 3564.47,1943.4143 L3824.9671,1943.4143 A0,0 0 0 0 3824.9671,1943.4143 L3824.9671,1713.7561 L3814.9671,1703.7561 L3564.47,1703.7561 A0,0 0 0 0 3564.47,1703.7561" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M3814.9671,1703.7561 L3814.9671,1713.7561 L3824.9671,1713.7561 L3814.9671,1703.7561" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160.6655" x="3570.47" y="1721.3245">Return to Path Creation:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3570.47" y="1736.635">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.8125" x="3570.47" y="1751.9455">After adjusting handles, user</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225.8179" x="3570.47" y="1767.2561">continues creating path (not finish).</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3570.47" y="1782.5666">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.041" x="3570.47" y="1797.8772">ModifyAnchorEvent emitted with:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.0234" x="3570.47" y="1813.1877">- pathId: current path</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.0757" x="3570.47" y="1828.4983">- anchorIndex: _anchorCount - 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.1157" x="3570.47" y="1843.8088">- handleOut: from drag end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225.3228" x="3570.47" y="1859.1194">- handleIn: -handleOut (symmetric)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.7778" x="3578.6966" y="1874.4299">OR null (Alt pressed)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.4971" x="3570.47" y="1889.7405">- undoGroupId: from StartGroupEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3570.47" y="1905.051">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.5591" x="3570.47" y="1920.3616">Path creation continues until</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.5728" x="3570.47" y="1935.6721">explicit finish or cancel.</text></g><g class="entity" data-entity="GMN44" data-source-line="427" data-uid="ent0045" id="entity_GMN44"><path d="M3842.83,1619.5561 L3842.83,2027.6303 L4194.6064,2027.6303 L4194.6064,1629.5561 L4184.6064,1619.5561 L3842.83,1619.5561" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M4184.6064,1619.5561 L4184.6064,1629.5561 L4194.6064,1629.5561 L4184.6064,1619.5561" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="221.1143" x="3848.83" y="1637.1245">Finish Path (Normal Completion):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3848.83" y="1652.435">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.7891" x="3848.83" y="1667.7455">Two triggers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.3481" x="3848.83" y="1683.0561">1. Double-click detection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.6343" x="3861.1698" y="1698.3666">&#8226; Time threshold: 500ms</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241.6299" x="3861.1698" y="1713.6772">&#8226; Distance threshold: 10.0 world units</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3848.83" y="1728.9877">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.8423" x="3848.83" y="1744.2983">2. Enter key press</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3848.83" y="1759.6088">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.8022" x="3848.83" y="1774.9194">Both emit same events:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.0503" x="3848.83" y="1790.2299">1. FinishPathEvent:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.0234" x="3861.1698" y="1805.5405">- pathId: current path</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.9019" x="3861.1698" y="1820.851">- closed: false</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.4971" x="3861.1698" y="1836.1616">- undoGroupId: from StartGroupEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3848.83" y="1851.4721">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.7524" x="3848.83" y="1866.7827">2. EndGroupEvent:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.9053" x="3861.1698" y="1882.0932">- groupId: from StartGroupEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.9023" x="3861.1698" y="1897.4038">- undoGroupEnd: true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3848.83" y="1912.7143">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.7256" x="3848.83" y="1928.0248">3. Flush events to persistence</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.543" x="3848.83" y="1943.3354">4. Reset state to idle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3848.83" y="1958.6459">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="175.1255" x="3848.83" y="1973.9565">Complete Event Sequence:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242.5439" x="3848.83" y="1989.267">StartGroupEvent &#8594; CreatePathEvent &#8594;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="330.7764" x="3848.83" y="2004.5776">AddAnchorEvent &#215; N &#8594; [ModifyAnchorEvent &#215; M] &#8594;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215.9092" x="3848.83" y="2019.8881">FinishPathEvent &#8594; EndGroupEvent</text></g><g class="entity" data-entity="GMN47" data-source-line="458" data-uid="ent0048" id="entity_GMN47"><path d="M3184.05,1319.1661 L3184.05,1482.2716 A0,0 0 0 0 3184.05,1482.2716 L3449.3903,1482.2716 A0,0 0 0 0 3449.3903,1482.2716 L3449.3903,1404.7261 L3466.89,1400.7261 L3449.3903,1396.7261 L3449.3903,1329.1661 L3439.3903,1319.1661 L3184.05,1319.1661 A0,0 0 0 0 3184.05,1319.1661" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M3439.3903,1319.1661 L3439.3903,1329.1661 L3449.3903,1329.1661 L3439.3903,1319.1661" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81.123" x="3190.05" y="1336.7345">Cancel Path:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3190.05" y="1352.045">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.3311" x="3190.05" y="1367.3555">Escape key pressed:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.5913" x="3190.05" y="1382.6661">- Emit EndGroupEvent ONLY</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.1118" x="3198.2766" y="1397.9766">(no FinishPathEvent)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244.3403" x="3190.05" y="1413.2872">- Incomplete path ignored by handlers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.7314" x="3190.05" y="1428.5977">- Reset state to idle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="3190.05" y="1443.9083">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.3169" x="3190.05" y="1459.2188">Undo group closed without</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.5615" x="3190.05" y="1474.5294">completing the path.</text></g><!--link *start*PenTool to P_Idle--><g class="link" data-entity-1=".start.PenTool" data-entity-2="P_Idle" data-source-line="322" data-uid="lnk25" id="link_.start.PenTool_P_Idle"><path d="M3591.72,813.3561 C3591.72,841.4861 3591.72,920.4561 3591.72,970.8161" fill="none" id="*start*PenTool-to-P_Idle" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="3591.72,976.8161,3595.72,967.8161,3591.72,971.8161,3587.72,967.8161,3591.72,976.8161" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.769" x="3592.72" y="844.5645">onActivate()</text></g><!--link P_Idle to P_Creating--><g class="link" data-entity-1="P_Idle" data-entity-2="P_Creating" data-source-line="324" data-uid="lnk26" id="link_P_Idle_P_Creating"><path d="M3523.03,1056.2561 C3447.04,1104.2261 3342.19,1188.6061 3397.72,1262.8961 C3414.64,1285.5361 3434,1267.1861 3458.72,1280.8961 C3480.48,1292.9561 3497.1934,1305.1478 3516.1234,1321.6178" fill="none" id="P_Idle-to-P_Creating" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="3520.65,1325.5561,3516.4857,1316.6309,3516.8779,1322.2742,3511.2346,1322.6663,3520.65,1325.5561" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.2813" x="3404.3821" y="1198.4645">onPointerDown</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.2764" x="3413.8846" y="1213.775">[first click] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.2344" x="3399.4055" y="1229.0855">StartGroupEvent,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.1963" x="3399.4246" y="1244.3961">CreatePathEvent,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.6055" x="3398.72" y="1259.7066">set currentPathId</text></g><!--link P_Creating to P_Creating--><g class="link" data-entity-1="P_Creating" data-entity-2="P_Creating" data-source-line="348" data-uid="lnk27" id="link_P_Creating_P_Creating"><path d="M3718.52,1388.3361 C3729.32,1390.9761 3736.06,1395.0961 3736.06,1400.7261 C3736.06,1406.3461 3735.1496,1409.0565 3724.3496,1411.6865" fill="none" id="P_Creating-to-P_Creating" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="3718.52,1413.1061,3728.2109,1414.8631,3723.378,1411.9231,3726.318,1407.0902,3718.52,1413.1061" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.6636" x="3775.217" y="1382.7945">onPointerUp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.9775" x="3742.06" y="1398.105">[drag distance &lt; 5.0] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104.3491" x="3761.8742" y="1413.4155">AddAnchorEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.2231" x="3757.4372" y="1428.7261">(anchorType: line)</text></g><!--link P_Creating to P_Creating--><g class="link" data-entity-1="P_Creating" data-entity-2="P_Creating" data-source-line="368" data-uid="lnk28" id="link_P_Creating_P_Creating"><path d="M3718.33,1370.4161 C3801.12,1364.9461 3891.06,1375.0461 3891.06,1400.7261 C3891.06,1426.3961 3807.107,1436.8909 3724.317,1431.4309" fill="none" id="P_Creating-to-P_Creating-1" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="3718.33,1431.0361,3727.0473,1435.6197,3723.3192,1431.3651,3727.5737,1427.637,3718.33,1431.0361" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.6636" x="3935.384" y="1375.2945">onPointerUp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.3115" x="3897.06" y="1390.605">[drag distance &gt;= 5.0] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104.3491" x="3922.0412" y="1405.9155">AddAnchorEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.4795" x="3909.476" y="1421.2261">(anchorType: bezier,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.2915" x="3908.07" y="1436.5366">handleIn, handleOut)</text></g><!--link P_Creating to P_Adjusting--><g class="link" data-entity-1="P_Creating" data-entity-2="P_Adjusting" data-source-line="388" data-uid="lnk29" id="link_P_Creating_P_Adjusting"><path d="M3516.28,1475.8761 C3498.16,1491.6161 3478.37,1507.4261 3458.72,1520.5561 C3443.52,1530.7161 3431.45,1523.0661 3421.72,1538.5561 C3380.94,1603.4861 3388.0966,1688.4642 3400.9766,1749.7842" fill="none" id="P_Creating-to-P_Adjusting" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="3402.21,1755.6561,3404.2745,1746.0261,3401.1822,1750.7629,3396.4454,1747.6705,3402.21,1755.6561" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.2813" x="3448.4248" y="1560.1245">onPointerDown</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.9146" x="3425.6082" y="1575.435">[click on last anchor] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.6909" x="3422.72" y="1590.7455">enter adjustment mode</text></g><!--link P_Adjusting to P_Creating--><g class="link" data-entity-1="P_Adjusting" data-entity-2="P_Creating" data-source-line="402" data-uid="lnk30" id="link_P_Adjusting_P_Creating"><path d="M3462.73,1755.5061 C3488.52,1715.3361 3522.82,1663.6661 3555.72,1619.5561 C3561.95,1611.2061 3566.64,1611.1361 3570.72,1601.5561 C3587.46,1562.2061 3592.9843,1520.7618 3594.4443,1481.9718" fill="none" id="P_Adjusting-to-P_Creating" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="3594.67,1475.9761,3590.3343,1484.8193,3594.4819,1480.9726,3598.3287,1485.1202,3594.67,1475.9761" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.5942" x="3610.3386" y="1552.1245">onPointerUp /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.71" x="3593.7808" y="1567.435">ModifyAnchorEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.8296" x="3611.221" y="1582.7455">(anchorIndex,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.2915" x="3588.49" y="1598.0561">handleIn, handleOut)</text></g><!--link P_Creating to P_Idle--><g class="link" data-entity-1="P_Creating" data-entity-2="P_Idle" data-source-line="422" data-uid="lnk31" id="link_P_Creating_P_Idle"><path d="M3551.66,1325.7661 C3542.62,1305.9361 3534.37,1284.0961 3529.72,1262.8961 C3513.63,1189.4761 3544.052,1110.0102 3567.782,1061.7602" fill="none" id="P_Creating-to-P_Idle" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="3570.43,1056.3761,3562.8687,1062.6869,3568.2234,1060.8628,3570.0474,1066.2175,3570.43,1056.3761" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.2813" x="3533.8811" y="1198.4645">onPointerDown</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.7568" x="3532.6433" y="1213.775">[double-click] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.6035" x="3530.72" y="1229.0855">FinishPathEvent,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.3057" x="3531.8689" y="1244.3961">EndGroupEvent,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.897" x="3546.5733" y="1259.7066">resetState()</text></g><!--link P_Creating to P_Idle--><g class="link" data-entity-1="P_Creating" data-entity-2="P_Idle" data-source-line="424" data-uid="lnk32" id="link_P_Creating_P_Idle"><path d="M3619.18,1325.6861 C3625.18,1305.5761 3630.68,1283.6261 3633.72,1262.8961 C3644.47,1189.5361 3623.861,1110.0003 3607.831,1061.7303" fill="none" id="P_Creating-to-P_Idle-1" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="3605.94,1056.0361,3604.9803,1065.8381,3607.5158,1060.7813,3612.5726,1063.3168,3605.94,1056.0361" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.5762" x="3653.0437" y="1198.4645">onKeyPress</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.6699" x="3649.9968" y="1213.775">[Enter key] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.6035" x="3637.53" y="1229.0855">FinishPathEvent,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.3057" x="3638.6789" y="1244.3961">EndGroupEvent,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.897" x="3653.3833" y="1259.7066">resetState()</text></g><!--link P_Creating to P_Idle--><g class="link" data-entity-1="P_Creating" data-entity-2="P_Idle" data-source-line="455" data-uid="lnk33" id="link_P_Creating_P_Idle"><path d="M3699.3,1325.4661 C3717.75,1307.2861 3734.32,1286.2461 3744.72,1262.8961 C3758.82,1231.2261 3761.08,1215.4561 3744.72,1184.8961 C3737.91,1172.1761 3728.48,1176.5061 3717.72,1166.8961 C3680.01,1133.2061 3647.1153,1092.9021 3623.1953,1061.0821" fill="none" id="P_Creating-to-P_Idle-2" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="3619.59,1056.2861,3621.8006,1065.8837,3622.5944,1060.2828,3628.1953,1061.0766,3619.59,1056.2861" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.5762" x="3771.5247" y="1205.9645">onKeyPress</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.0674" x="3763.2791" y="1221.275">[Escape key] /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.3057" x="3757.16" y="1236.5855">EndGroupEvent,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.897" x="3771.8643" y="1251.8961">resetState()</text></g><!--link GMN32 to P_Creating--><g class="link" data-entity-1="GMN32" data-entity-2="P_Creating" data-source-line="351" data-uid="lnk34" id="link_GMN32_P_Creating"><path d="M3111.09,1280.4761 C3131.68,1257.5661 3156.06,1236.7561 3183.72,1223.8961 C3290.92,1174.0461 3343.03,1172.9661 3449.72,1223.8961 C3494.26,1245.1561 3529.4,1287.8161 3553.69,1325.9061" fill="none" id="GMN32-P_Creating" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g><!--link P_Creating to GMN44--><g class="link" data-entity-1="P_Creating" data-entity-2="GMN44" data-source-line="427" data-uid="lnk46" id="link_P_Creating_GMN44"><path d="M3678.78,1475.8761 C3725.61,1517.1261 3783.97,1570.0061 3833.72,1619.5561 C3836.59,1622.4161 3839.48,1625.3061 3842.37,1628.2261" fill="none" id="P_Creating-GMN44" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g><g class="entity" data-entity="N1" data-source-line="520" data-uid="ent0018" id="entity_N1"><path d="M4414.19,1215.9978 L4414.19,1578.1404 L4767.9468,1578.1404 L4767.9468,1225.9978 L4757.9468,1215.9978 L4414.19,1215.9978" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M4757.9468,1215.9978 L4757.9468,1225.9978 L4767.9468,1225.9978 L4757.9468,1215.9978" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="216.1313" x="4420.19" y="1233.5662">50ms Sampling Implementation:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="4420.19" y="1248.8767">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322.1309" x="4420.19" y="1264.1873">Tools implementing drag operations use a sampler</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.6069" x="4420.19" y="1279.4978">to throttle event emission:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="4420.19" y="1294.8084">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49.499" x="4420.19" y="1310.1189">```dart</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243.3501" x="4420.19" y="1325.4295">// Inside tool's onPointerMove handler</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="332.7568" x="4420.19" y="1340.74">final now = DateTime.now().millisecondsSinceEpoch;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.3838" x="4420.19" y="1356.0505">if (now - _lastSampleTime &gt;= 50) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.3628" x="4428.4166" y="1371.3611">eventRecorder.record(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.3281" x="4436.6431" y="1386.6716">MoveObjectEvent(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.1499" x="4444.8697" y="1401.9822">objectIds: selectedIds,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.8813" x="4444.8697" y="1417.2927">delta: currentDelta,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.3218" x="4444.8697" y="1432.6033">samplingIntervalMs: 50,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.4341" x="4444.8697" y="1447.9138">undoGroupId: _currentGroupId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.3408" x="4436.6431" y="1463.2244">),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.3408" x="4428.4166" y="1478.5349">);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.5273" x="4428.4166" y="1493.8455">_lastSampleTime = now;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.2275" x="4420.19" y="1509.156">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23.9561" x="4420.19" y="1524.4666">```</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="4420.19" y="1539.7771">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288.7993" x="4420.19" y="1555.0877">First and last events in a drag do NOT include</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.4067" x="4420.19" y="1570.3982">samplingIntervalMs (lifecycle markers).</text></g><g class="entity" data-entity="N2" data-source-line="546" data-uid="ent0019" id="entity_N2"><path d="M4803.23,1254.2678 L4803.23,1539.8577 L5192.9209,1539.8577 L5192.9209,1264.2678 L5182.9209,1254.2678 L4803.23,1254.2678" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M5182.9209,1254.2678 L5182.9209,1264.2678 L5192.9209,1264.2678 L5182.9209,1254.2678" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="241.9219" x="4809.23" y="1271.8362">Tool Activation Flow (ToolManager):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="4809.23" y="1287.1467">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.979" x="4809.23" y="1302.4573">When switching tools:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242.6328" x="4809.23" y="1317.7678">1. Previous tool's onDeactivate() called</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="368.6909" x="4809.23" y="1333.0784">2. EventRecorder.flush() ensures buffered events persisted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201.3921" x="4809.23" y="1348.3889">3. New tool's onActivate() called</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274.8726" x="4809.23" y="1363.6995">4. CursorService.setCursor() updates cursor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275.501" x="4809.23" y="1379.01">5. ToolManager.notifyListeners() updates UI</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="4809.23" y="1394.3205">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="357.0239" x="4809.23" y="1409.6311">See: lib/application/tools/framework/tool_manager.dart</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="4809.23" y="1424.9416">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="195.7173" x="4809.23" y="1440.2522">Event Recorder Coordination:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270.2769" x="4809.23" y="1455.5627">Tools do NOT directly call EventRecorder&#8212;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292.2334" x="4809.23" y="1470.8733">they generate event objects, and ToolManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225.2275" x="4809.23" y="1486.1838">coordinates with EventRecorder for:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.3569" x="4809.23" y="1501.4944">&#8226; Pause/resume during replay</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.6895" x="4809.23" y="1516.8049">&#8226; Flush on pointer up / tool switch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234.0254" x="4809.23" y="1532.1155">&#8226; Undo group boundary enforcement</text></g><!--SRC=[pLlTZXkt5RxVfo2s5v4CIRjsOnHLuW3hdNMog7TNyAuR5BRXZ3IKDF5eg0v7-vCYGAxw04M0tlS9-Wpjc-H9Udv83iaPxQuJswWHnvgPG_BmyFnzXsITruKK5qeLubcLhkILgjw9ypgjfJX9Pykyb68epcKXPtMkoe58yWf- -c_ICXCJML8VUcVdC_7a0_w1xYwMkHPPdYw0FP6fsMOborgBUYd5JAtMXGHMDJ6yCWpFLKMVQvpLtCvg07tDrAMiydB1dvULHE9DcQKubRIW5bhafVWMfdcnAMKrRayU-kcOFZKTYIFWWGTMQra1Lrgay5_4uLLUBw6RkafBdMC_CCCgluHkfZTYhVAobfMGbpZHWNWdRwOghJBWQxsfUSJ51b_CL9bnyz7EPoGgwIIbb-fAZ-7bK1mKF3DcGelUSLR8WVW6XJ4G4nukKLSumofTB4100t6eLgkyxbC7h0y-jpW1U94l5hA23WtBUuvLvfrRVntnIklZ7b7gJSVCxupfUjoBaC18BRC-ZmhBfSIYKfirBkGghTu12zJkyVvA2vs2Jk2Nj2nLdJOZBlF5SZYlv5ytifpTWBpJXLaZD_0HZYUE4qqohc_Mafi2WpEPJlCYhsz0aZoxjtgsbAjqjCf8zWc8Q2mUxJzwF7puSBZ_HtZrPs0C-XwBXwDzU7mX2w39ngB8ftlf6hYSqTXxf3fxJb7f-UqgBLCGxYXBgzfl31QWzoevbnLCG-wrMB6KF1cD-YkPOL6dqqAIUakdfPhrM4nbeQu-jF52VsavMogm8XniIFetD4Rm4Lo5CqjsQ84R- -1pOulU3SVSHMjthuYBl-q84TEY0JBfM_n9DC8-Z9dx52WlSIK7uYe5wm2LHbqa9n2IdofOHii5DPCX0LcwoC1JCeqiKHCo8FfnfuCx8ZViSLFB7p-DnOdQQ2deWKV6_eIQVe_kCIITLF8obrSUXsY81VoDAGytbKPLiVwljmGhx6zZqdDRXbNywJYbXx5rRc9TIQt1A61uvbAW3qhBorI73Ix0rD-nSu0HgnguOTSKaYKWosg5hZpbIQ6p68Sql_pqBt76Wyt0rj-99qO8RR93uiIHWLC3BoMPWsq2iAxQpXvPThF7Xx7pvcPSd3_neqEoinSuuIlZJdbajrfJTHrI3uVXypawtCRVX1znSYUmlYm7zgyzyjEqBfTfqMyt07vEc8-NQmZDqZIxpFK6eeKgYvkjMi5HouY47vnGpEDOFCiXwkG_-BC4RLW1cqr0YDiSuJz7PVOr1Xvc2Asn2KPnWnTIozefKYqjnwyUl04HVjKOfoeFZANt-aXWFZ2DjGsdxoZCr-Mh9Rtd_v5etuYzr-M6n2LcP4ZS5tSG3HZsLIfHg7BHqLz5SzZMdT7Vm1IXEsTYr4KTsLDhXjjxOVEaNjWKZN9o5zIkUrulrz013Pdbq1B2fFXIF1xjlouFJXCHyiUQm-gfQLsnUyWSfAZGHmarDuFH0ZzuS4WssdZz7dXVrDt- -C637QAXV6SiGWOWy6BEcfR8Y5ZdrnAJPT8Pi3lWdsqVKnqRG7ocsAo6XlFZ3EBwAshXR1hIbZU6QAKoI4LsAxak86_P5RrCpjDDKVV3xscMmRVpPJwlhN-CA6grM62WwXskCZIHmxeg6b8Z43Q6HCxpaXmboW6_KCvnWMxHsgS_eLsYUG7P6EJK82qtiG4DJb_FrfmWZidCoFAECnuMX1xcWMYCsfFa2CWa976uaYs5CRucDeHmnRvwWal5IeBgrrZ-01GIx2BNphy-WHHn8vtc579k5GSeZ9neq3FhNmJrgMzN6cOXq1RoGn4_LZaMB24KLmw68bw-F4xCfqpgMPMJF64vJiZLyMhmGWXqkhidiVVVjOjySQMODrmSRPVuuOYSUtTuWJ-__FqVRU-lELwmgZqQeV5SkRXZeurjt146GC9YZPcrhhcNQ9cHo-tBZCiPiVIwx5dGS6o2qWdOr-FzVgShQ5RKHZuQnuG_kvx9Xd2ciKsCBGCoxbWUH9pM8eY907qIESiHF8Z7_V5EovwYJcunfamMTHfPKtks69FxTzbSWbs1rWERiqeY2ayHNgkLA59TCty3eiGbeW-DtnzPJR8wTe8knkXHI-y0vG1GEJsx89aHZL4RWon_-Ubdp0E4oGdcKcRJbArUS7plSA8MI18H368JpSrwT9iQkP3k1HXKetoEwmfo78ivZTZIAwJWgOqxs7bT1la4Zsi62mBRdg10J72croZbLDKro9YqaflP4CLzX0x7QUQ31yUMSMkldZq_wve96ftJ6cUuOJRKCzvdq2WE48p9CNAJtqFlnKOlpH8YaBPs3CxEPovM1u-_ZbNjENLdfJFDk_aqNhIimL9OFK6X5UJnJJXfAuENhhXSuq_oPeAH4E8660OMeTx96ueM_DYPKZI10VknWO6RdridUjOiYhKxqxs3CLVBtE4jxTolZGCK8pguQAKGaDbLy07igDE33srkmgODK_2a94gmEMDBGlHIKCLyrkJFWMF-yIDW_RWG-GaXV-VGX3duorRydvmxu9y4o3zvJ-YVR8NsICSr5xttz72Y8tABiMULqdgPvbMG7FgGAZbloW19M0T8EWi1F2exLKmMOVIOsjO236bO24ZQbG22P5G6uD9VMbNgIhSvZMi1IL0CI6wh1Z0hUnwpzoe4D7JdjG9FqdGZLh9E8Lr9Mrm6W3q947lIXkmTuXGe2UCscXRFSn3IsaWMVCiw1Kd1egfgbGRy1l0zkHM_9n60p_BvpG4nj0t2XrFrO7WIuV2a2uZxuiF1J6MqrO0ycmss4LFTn7T0zW2I9rinUUB5WEHUgBoPKJSoJtmidTmNcqUznlWyxdGxjeuwwaBfYGUPalk3R0zLy-9iGzL91wpc5erdlHqUVRa57RK6ju4HJGFnqJh5i4UFvWlBuxZCyfdqiRMnmhpCvFM7WDVlZPdzQSHfFazd439ly7Ehj125xpZ9YLRxKo7avFyN8gDxCQBrCV91zlq6qCvJ-KCEXiOUsS3afnAc6kr2KLrYfHJuP5AOcox1MwoHt8PP8tVtFgWrwOIjnjXEF8SRmrUKjSEjNVxsLo3Ng9ixbLfU3yBOsq1KblvnEJ2_panwz9kXBi1KaWhk_nuKjO1atrZeK9mgPyyGF6zM4Eyho7oP0rlww5dMGF67ZZdh8IQsEKvl3Tg0tc1R1niGH0eX06H2aDVhZMWdHZO8PDAfLiMcbWE2u8Jzxz2tRU1sIv0TT83M942joVrXQzADMs_JIm-XjdAIJuLHxmIFGhp4PqZ99FWl6qEmgqeEgPdLvz77HadsOCQd0KPsD4hyu276F_3A0Q29ZtycxmT_9jxE9-ztSjRRCu1sGZu4JA_S56Q3QR8L0KN9A_1uMCaKHyLk3A_sbUFNlHZJSGNBmLJYknb-DDWu89r0nj0aztpCGCi5dMZfe3P9VIclQqk6QiHfPk0JWtOcnG_xCj37p_830apqWqIH2h2jnF3sTXIji9t9TmqikQCLU1niGs7668iq4IPQ6Gw-qCKtx2pDwhZNRdcQDx0-xdSGjD5okNB9OtQqFBGxB05XB7c_XSjtO9bIpXHc2j9hq6f2ShgZZLkkW6cEEi3oChtCGM4xQ528zuX6xKPtn9y054ssOQ990uc2fOtHnZoljDa1tv8gKcE9rkOdZu4jjtEQYLz2UqPZcAqvoXe5jcjIHrdIOIoRzd6ImIUfE2IClDnHynaXiv-FHSUkP3BC9rqYsP5BylneqDs6neKWwdtiycEAMv58l14jXWa79ECyC6TjB7W9zDIGLUgTF5G5alrkd_v4-CMZ-pRFG8R0pdu7ryW3X5j9nzkcOFVC-uKxouKcCFCyAPlno5B1Ihr5esAc9rq1SITm6jiLxLOeUf1bOTRCHipfAEGAijy29SqeHhsW3z21AYNTUuwdFeoeVmqy3HcomCJFaKEAtGYy6hlmqQjTwERiJB3q5jwQxd7IjjDWEQbw7kcwsswr-UYUopz5JrkPa1n7xToPqM-JFH-gajgK6FeGceAEVFxuF_zkjfJqXz803vpUgW9JYWdWSph0HB_BxNJeXeaha5fStayrjg7MZweRKVG2ktTXlT-b9omPEuGJYfaBhj6mCo8EdQwCFUm3scAZKx-1qvYWYHu6EnF41bHhCJ6f_tvQch2CAxk7QCze8Jm5zW0rC3TtgfWVB-DmnkSqmeo0j4oIuN7GfqpDrc4Yt-8w3ofVqE5px33IdiHg31vMrajLW00UxeFgNAcgo32SrLP_IZxTkT6oyh8FFn58v-GQR0vgrPRdOAptS2afTZmzUdRsuaXaQWEz3cdIzBtPQM0yGxWAKfmvK7GPRoFAswntMuN3BmBStq9Z2R-GzQOYXYaECGiUg3oODok7h1cP3KYMH84vN5vkGBmseXd0GJlTe5rwQTrV6vYQNMVQmXZVRR3UdCVYBJyTgWqG3SN3jZ4s- -mW-DzkV-zfSYJGcH6e9oPWDo-u-7ED1vrpAoPpxd8cYpkjCAuu6mFqLP8CxnbrxAUF0UeVc3gvLuVOFfItgtj4zcmtTTz_aAZOqGeSt2DBi7UAkpK57hh72msuV-gq4u_Us9FsBYDDF24qDkcEpa2EVv6l0g_nU7z_fNs2-xiMggCOOR2Uc7edLZK9jL4YA3reoNKQNs8TAMnB-Udhh524JUPfeUMMn7ExGiOrdwvSlRDrUo1N6jgvJsa8IJuVcMEVZ5Y18aUCqfIt-BOAkuLpYp9CRXGnH90uWW7uZZrMa0M8__vJd1BzgxRtWMydRrp3Q56eKLZGkwzH-fQYP-cwEVzmByFOcciVadC8uLipWCEw_b67iCXtTlhyBxQ8MgfunjQ_7PVkyX1vydnHgWgSzDGMM2jx1cBhYhvipaAmpfA7LwP6PRgtburma8zUxNik5zW_mjgl2pK5Xt8AG-aFNkuhU9nQhMaTTt3TU6nUCRl1TMvtGO9D0TBtRyBRECQcx26lrhO2jAYneffjPlOsowKgDk1r-2ZC2Z153N_fi7kutO8dU5fRt9tdqfi37NGr1eDgtz6soisjKo1CluDegHns3zbrUWb00GJGscpJsG5Zo-yL-LpERcOqLxpoP0aZLz1qPrDptAHSaURJof3MVcsEpV9Qd03upuSirUP65AisJE4oJnt_aO_gTHKnB6UqvxAIMOwMOnQu5xXnh65OwgXItrMW9_xvDjcXkqt6KtZbxfEHhuFGf0gPGaQ2wInWl3aUqcZkcK6BesjQ8RSqtGK4xCjjd_9n_cvw2pUnGNYrpD9t7Db7uYKuCB1HZ8Bes7ppEKxCxF02dn4W0ELYaqdBDRqzpaGFHNdvkHLc3S4V65kjuKEPNujLNXIvbYWatVUR8jGZ74zt_kHrIfTLW1DHGaWFI6sy4hqVPAM6qnGz7csCMp9xETFd1wqFZp_USMsDPZsfr6MUWNnGSnPc4xXn7NymhkF2NMKKl3EcRNw4QmHc-fnYCdZm7d86wajDJlX27VeHKvr-UGnEWlSF2d0K4jq-Eh6T7GfHgHQd3uanyaNEcHsZtj3nLmz5NF3DKVl9RfxwzeGdfLBZuYfsQ91wGO9eJzXXBgNfnY3s-DrttsLSST_R0ubea0pvfSzqL6ytyGe8UTEkL5VY2Tr7n1nm18-z_iZNW7DG8dcqLhFb5z0edsESl898H_KuTboKFQ9Ex_TDJPquV04TLB12euf-z4oSZJofVItyiuRsX26UIdRVQOVI9O9qmBZvsBsztNmFNCbRquTvOQdw_AF_1VqJJ_09okeBgdYJl57iN4h64DgSQgOxawcfuIWwbspiS4TqRZ77pbhtIRrCMkMqwn5f5-cpgQsZdZyhO3LwdifQBF3jKfP2GvA1ctWBld6CZW2IRTegKXlTQ4WYKrUk1yHLy7q_J8-3XPnZIWiKijGRIAt4T3D76xNdh9kJzZkK0P_AgsQ8Wuu180Nc7RPp44O-aoD8dlW5KB7TQNjYIO3Bz4rpr39Vr-BbiVCaxtzxrdEfTjuGGE1VC9Vcz0rRi5bUhY8LDpInK6I__FGp6kyIaj65tLOmiPFZEj_GzkQrWzcW6KwQkzD1bxYzQJtw90K_0PvIOtAJyJ4CJcKC0OEGuFYws3ENUKat39sNdaxfZdi5QLO98t4wqEZZ_m00]--></g></svg>